<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>react å…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹(ä¸‡å­—æ€»ç»“âœ) | é›¨é†‰å—é£</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/vblog/logo.svg">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
    <meta name="description" content="welcome to my blog">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/vblog/assets/css/0.styles.a0d8b914.css" as="style"><link rel="preload" href="/vblog/assets/js/app.f9cc2ca1.js" as="script"><link rel="preload" href="/vblog/assets/js/2.8e16adc6.js" as="script"><link rel="preload" href="/vblog/assets/js/72.e1d9d0ff.js" as="script"><link rel="prefetch" href="/vblog/assets/js/10.a997e3cb.js"><link rel="prefetch" href="/vblog/assets/js/100.1be4e280.js"><link rel="prefetch" href="/vblog/assets/js/101.36e0f527.js"><link rel="prefetch" href="/vblog/assets/js/102.cdce4625.js"><link rel="prefetch" href="/vblog/assets/js/103.73875c4a.js"><link rel="prefetch" href="/vblog/assets/js/104.8560f544.js"><link rel="prefetch" href="/vblog/assets/js/105.d02cfd45.js"><link rel="prefetch" href="/vblog/assets/js/106.3af8720e.js"><link rel="prefetch" href="/vblog/assets/js/107.a2b0e3c6.js"><link rel="prefetch" href="/vblog/assets/js/108.0e21f939.js"><link rel="prefetch" href="/vblog/assets/js/109.10db0503.js"><link rel="prefetch" href="/vblog/assets/js/11.aa8470cd.js"><link rel="prefetch" href="/vblog/assets/js/110.1b41e22e.js"><link rel="prefetch" href="/vblog/assets/js/111.a01cf4ba.js"><link rel="prefetch" href="/vblog/assets/js/112.538bc8fb.js"><link rel="prefetch" href="/vblog/assets/js/113.8de6fd1c.js"><link rel="prefetch" href="/vblog/assets/js/114.bee8cd15.js"><link rel="prefetch" href="/vblog/assets/js/12.d66867ea.js"><link rel="prefetch" href="/vblog/assets/js/13.6ce9bccb.js"><link rel="prefetch" href="/vblog/assets/js/14.8dee6d3f.js"><link rel="prefetch" href="/vblog/assets/js/15.d278d0d7.js"><link rel="prefetch" href="/vblog/assets/js/16.3a63febe.js"><link rel="prefetch" href="/vblog/assets/js/17.d8f8a499.js"><link rel="prefetch" href="/vblog/assets/js/18.2709b908.js"><link rel="prefetch" href="/vblog/assets/js/19.772b14ff.js"><link rel="prefetch" href="/vblog/assets/js/20.5ef5f5c5.js"><link rel="prefetch" href="/vblog/assets/js/21.bbe1be10.js"><link rel="prefetch" href="/vblog/assets/js/22.16da3071.js"><link rel="prefetch" href="/vblog/assets/js/23.e027f0a1.js"><link rel="prefetch" href="/vblog/assets/js/24.464c21a0.js"><link rel="prefetch" href="/vblog/assets/js/25.734b2a0b.js"><link rel="prefetch" href="/vblog/assets/js/26.79c7116d.js"><link rel="prefetch" href="/vblog/assets/js/27.0b5ac957.js"><link rel="prefetch" href="/vblog/assets/js/28.61e632d7.js"><link rel="prefetch" href="/vblog/assets/js/29.80e8b433.js"><link rel="prefetch" href="/vblog/assets/js/3.d4c69e27.js"><link rel="prefetch" href="/vblog/assets/js/30.1be2dbf8.js"><link rel="prefetch" href="/vblog/assets/js/31.db34fead.js"><link rel="prefetch" href="/vblog/assets/js/32.9be2f1ff.js"><link rel="prefetch" href="/vblog/assets/js/33.09ab7613.js"><link rel="prefetch" href="/vblog/assets/js/34.12e11bea.js"><link rel="prefetch" href="/vblog/assets/js/35.0e85d2c0.js"><link rel="prefetch" href="/vblog/assets/js/36.c28a20c0.js"><link rel="prefetch" href="/vblog/assets/js/37.00cc8409.js"><link rel="prefetch" href="/vblog/assets/js/38.ad9a1400.js"><link rel="prefetch" href="/vblog/assets/js/39.6ad19f39.js"><link rel="prefetch" href="/vblog/assets/js/4.7bb957bc.js"><link rel="prefetch" href="/vblog/assets/js/40.9f61c24e.js"><link rel="prefetch" href="/vblog/assets/js/41.050ff8ed.js"><link rel="prefetch" href="/vblog/assets/js/42.d7627ca9.js"><link rel="prefetch" href="/vblog/assets/js/43.4a276c77.js"><link rel="prefetch" href="/vblog/assets/js/44.7ba7587f.js"><link rel="prefetch" href="/vblog/assets/js/45.ef18413c.js"><link rel="prefetch" href="/vblog/assets/js/46.46afa358.js"><link rel="prefetch" href="/vblog/assets/js/47.19aab06a.js"><link rel="prefetch" href="/vblog/assets/js/48.763a38a8.js"><link rel="prefetch" href="/vblog/assets/js/49.c880fbdb.js"><link rel="prefetch" href="/vblog/assets/js/5.af61ee29.js"><link rel="prefetch" href="/vblog/assets/js/50.66e67e15.js"><link rel="prefetch" href="/vblog/assets/js/51.1e30d328.js"><link rel="prefetch" href="/vblog/assets/js/52.72c3ac23.js"><link rel="prefetch" href="/vblog/assets/js/53.49dc7f9c.js"><link rel="prefetch" href="/vblog/assets/js/54.9bf65734.js"><link rel="prefetch" href="/vblog/assets/js/55.ecec9fd5.js"><link rel="prefetch" href="/vblog/assets/js/56.29fab29b.js"><link rel="prefetch" href="/vblog/assets/js/57.e24f45bd.js"><link rel="prefetch" href="/vblog/assets/js/58.e321f036.js"><link rel="prefetch" href="/vblog/assets/js/59.d32c67fc.js"><link rel="prefetch" href="/vblog/assets/js/6.582c480d.js"><link rel="prefetch" href="/vblog/assets/js/60.b6177c27.js"><link rel="prefetch" href="/vblog/assets/js/61.ac17bac8.js"><link rel="prefetch" href="/vblog/assets/js/62.d1843092.js"><link rel="prefetch" href="/vblog/assets/js/63.6de0fbbb.js"><link rel="prefetch" href="/vblog/assets/js/64.ade80ec9.js"><link rel="prefetch" href="/vblog/assets/js/65.b99c8df3.js"><link rel="prefetch" href="/vblog/assets/js/66.d55de553.js"><link rel="prefetch" href="/vblog/assets/js/67.38f5f036.js"><link rel="prefetch" href="/vblog/assets/js/68.78fea0db.js"><link rel="prefetch" href="/vblog/assets/js/69.7cab8dec.js"><link rel="prefetch" href="/vblog/assets/js/7.7c478b7b.js"><link rel="prefetch" href="/vblog/assets/js/70.77c13a9b.js"><link rel="prefetch" href="/vblog/assets/js/71.af96c551.js"><link rel="prefetch" href="/vblog/assets/js/73.af207941.js"><link rel="prefetch" href="/vblog/assets/js/74.5db1aca3.js"><link rel="prefetch" href="/vblog/assets/js/75.bcb5cdcf.js"><link rel="prefetch" href="/vblog/assets/js/76.769262f4.js"><link rel="prefetch" href="/vblog/assets/js/77.ac74853f.js"><link rel="prefetch" href="/vblog/assets/js/78.bdebbf92.js"><link rel="prefetch" href="/vblog/assets/js/79.13b04335.js"><link rel="prefetch" href="/vblog/assets/js/8.94b05543.js"><link rel="prefetch" href="/vblog/assets/js/80.920ab12f.js"><link rel="prefetch" href="/vblog/assets/js/81.120891ef.js"><link rel="prefetch" href="/vblog/assets/js/82.9c92f16c.js"><link rel="prefetch" href="/vblog/assets/js/83.8fa9efb5.js"><link rel="prefetch" href="/vblog/assets/js/84.11372395.js"><link rel="prefetch" href="/vblog/assets/js/85.8e4017c3.js"><link rel="prefetch" href="/vblog/assets/js/86.d242232f.js"><link rel="prefetch" href="/vblog/assets/js/87.f3938232.js"><link rel="prefetch" href="/vblog/assets/js/88.05d21186.js"><link rel="prefetch" href="/vblog/assets/js/89.923dbc9c.js"><link rel="prefetch" href="/vblog/assets/js/9.a06b764b.js"><link rel="prefetch" href="/vblog/assets/js/90.41bd888e.js"><link rel="prefetch" href="/vblog/assets/js/91.55ae6435.js"><link rel="prefetch" href="/vblog/assets/js/92.2cce6389.js"><link rel="prefetch" href="/vblog/assets/js/93.379cd4f4.js"><link rel="prefetch" href="/vblog/assets/js/94.5ad0b4aa.js"><link rel="prefetch" href="/vblog/assets/js/95.0e6332b7.js"><link rel="prefetch" href="/vblog/assets/js/96.8f2a9314.js"><link rel="prefetch" href="/vblog/assets/js/97.64a84d8b.js"><link rel="prefetch" href="/vblog/assets/js/98.a568a03b.js"><link rel="prefetch" href="/vblog/assets/js/99.93b1a588.js">
    <link rel="stylesheet" href="/vblog/assets/css/0.styles.a0d8b914.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/vblog/" class="router-link-active home-link"><img src="/vblog/logo.svg" alt="é›¨é†‰å—é£" class="logo"> <span class="site-name">é›¨é†‰å—é£</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/vblog/" class="router-link-active">
          é¦–é¡µ
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-submenu-selected"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          ğŸƒå‰ç«¯
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/vblog/notes/">
          ğŸ“å­¦ä¹ ç¬”è®°
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          ğŸŒ±å…¶ä»–
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          ğŸŒˆè”ç³»
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <a href="https://github.com/well-he/vblog" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html" title="reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹" class="active sidebar-link">reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#ç»„ä»¶é€šä¿¡" title="ç»„ä»¶é€šä¿¡" class="sidebar-link">ç»„ä»¶é€šä¿¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#props" title="props" class="sidebar-link">props</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#context" title="Context" class="sidebar-link">Context</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#onref" title="OnRef" class="sidebar-link">OnRef</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#ref" title="ref" class="sidebar-link">ref</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#ç¬¬ä¸‰æ–¹å·¥å…·" title="ç¬¬ä¸‰æ–¹å·¥å…·" class="sidebar-link">ç¬¬ä¸‰æ–¹å·¥å…·</a></li></ul></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#è·¯ç”±" title="è·¯ç”±" class="sidebar-link">è·¯ç”±</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#react-router" title="react-router" class="sidebar-link">react-router</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#è·¯ç”±ç»„ä»¶" title="è·¯ç”±ç»„ä»¶" class="sidebar-link">è·¯ç”±ç»„ä»¶</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#åŒ¹é…ç»„ä»¶" title="åŒ¹é…ç»„ä»¶" class="sidebar-link">åŒ¹é…ç»„ä»¶</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#å¯¼èˆªç»„ä»¶" title="å¯¼èˆªç»„ä»¶" class="sidebar-link">å¯¼èˆªç»„ä»¶</a></li></ul></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#çŠ¶æ€ç®¡ç†" title="çŠ¶æ€ç®¡ç†" class="sidebar-link">çŠ¶æ€ç®¡ç†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#redux" title="redux" class="sidebar-link">redux</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#react-redux-å’Œ-redux" title="react-redux å’Œ redux" class="sidebar-link">react-redux å’Œ redux</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#connected-react-router-å’Œ-redux" title="connected-react-router å’Œ redux" class="sidebar-link">connected-react-router å’Œ redux</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#å°ç»“ä¸€ä¸‹" title="å°ç»“ä¸€ä¸‹" class="sidebar-link">å°ç»“ä¸€ä¸‹</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#dva" title="dva" class="sidebar-link">dva</a></li></ul></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#ç”Ÿå‘½å‘¨æœŸ-æ–°æ—§å¯¹æ¯”" title="ç”Ÿå‘½å‘¨æœŸ(æ–°æ—§å¯¹æ¯”)" class="sidebar-link">ç”Ÿå‘½å‘¨æœŸ(æ–°æ—§å¯¹æ¯”)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#æ—§ç‰ˆç”Ÿå‘½å‘¨æœŸ" title="æ—§ç‰ˆç”Ÿå‘½å‘¨æœŸ" class="sidebar-link">æ—§ç‰ˆç”Ÿå‘½å‘¨æœŸ</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#æ–°ç‰ˆç”Ÿå‘½å‘¨æœŸ" title="æ–°ç‰ˆç”Ÿå‘½å‘¨æœŸ" class="sidebar-link">æ–°ç‰ˆç”Ÿå‘½å‘¨æœŸ</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#static-getderivedstatefromprops" title="static getDerivedStateFromProps" class="sidebar-link">static getDerivedStateFromProps</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#getsnapshotbeforeupdate" title="getSnapshotBeforeUpdate" class="sidebar-link">getSnapshotBeforeUpdate</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#ç‰ˆæœ¬è¿ç§»" title="ç‰ˆæœ¬è¿ç§»" class="sidebar-link">ç‰ˆæœ¬è¿ç§»</a></li></ul></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#æ€§èƒ½ä¼˜åŒ–" title="æ€§èƒ½ä¼˜åŒ–" class="sidebar-link">æ€§èƒ½ä¼˜åŒ–</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#shouldcomponentupdate" title="shouldComponentUpdate" class="sidebar-link">shouldComponentUpdate</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#purecomponet" title="PureComponet" class="sidebar-link">PureComponet</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#memo" title="Memo" class="sidebar-link">Memo</a></li></ul></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#hooks" title="hooks" class="sidebar-link">hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#usestate" title="useState" class="sidebar-link">useState</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#useeffect" title="useEffect" class="sidebar-link">useEffect</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#useref" title="useRef" class="sidebar-link">useRef</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#usecontext" title="useContext" class="sidebar-link">useContext</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#usememo" title="useMemo" class="sidebar-link">useMemo</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#usecallback" title="useCallback" class="sidebar-link">useCallback</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#è‡ªå®šä¹‰-hook" title="è‡ªå®šä¹‰ hook" class="sidebar-link">è‡ªå®šä¹‰ hook</a></li></ul></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#é¡¹ç›®é…ç½®" title="é¡¹ç›®é…ç½®" class="sidebar-link">é¡¹ç›®é…ç½®</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#æ€»ç»“" title="æ€»ç»“" class="sidebar-link">æ€»ç»“</a></li><li class="sidebar-sub-header"><a href="/vblog/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.html#å‚è€ƒ" title="å‚è€ƒ" class="sidebar-link">å‚è€ƒ</a></li></ul></li><li><a href="/vblog/front-end/react/ReactåŸºç¡€çŸ¥è¯†.html" title="ReactåŸºç¡€çŸ¥è¯†" class="sidebar-link">ReactåŸºç¡€çŸ¥è¯†</a></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="react-å…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹-ä¸‡å­—æ€»ç»“-âœ"><a href="#react-å…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹-ä¸‡å­—æ€»ç»“-âœ" class="header-anchor">#</a> react å…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹(ä¸‡å­—æ€»ç»“ âœ)</h1> <p><img src="https://i.loli.net/2020/05/30/Tl7uPjqFweDWidO.png" alt="title.png"></p> <p>ç¬”è€…ä»å»å¹´ 12 æœˆå¼€å§‹æ¥è§¦<code>react</code>ï¼Œé€æ­¥ç”±æ‡µé€¼èµ°å‘ç†Ÿæ‚‰ã€‚ä¸è¿‡<code>react</code>çš„éœ€è¦æŒæ¡çš„çŸ¥è¯†ç‚¹å¯çœŸçš„æœ‰ç‚¹å¤šå‘¢ã€‚æ‰€ä»¥èŠ±äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´æ¥æ•´ç†è¿™æ ·ä¸€ç¯‡<code>react</code>çš„åŸºç¡€çŸ¥è¯†æ€»ç»“çš„æ–‡ç« ï¼Œä»¥æ­¤è¾¾åˆ°æ¸©æ•…çŸ¥æ–°çš„ç›®çš„ã€‚æ–‡ç« ä¼šæ¶‰åŠåˆ°<code>react</code>æœ¬èº«çš„åŸºç¡€çŸ¥è¯†(åŒ…æ‹¬ç»„ä»¶é€šè®¯ã€ç”Ÿå‘½å‘¨æœŸã€è·¯ç”±ç®¡ç†ã€çŠ¶æ€ç®¡ç†ç­‰æ–¹é¢)ï¼Œç›¸ä¿¡ä½ è®¤è®¤çœŸçœŸçœ‹å®Œè¿™ç¯‡æ–‡ç« ä»¥åï¼Œä½ ä¼šå¯¹<code>react</code>å¼€å‘æœ‰ä¸ªå¤§è‡´çš„äº†è§£ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¿«é€Ÿå…¥é—¨ã€‚è¿™ç¯‡æ–‡ç« ä¹Ÿå¯ç”¨ä½œé¢è¯•å¤ä¹  react åŸºç¡€ï¼Œå¹¶ä¸”è¿™ç¯‡æ–‡ç« ä¼šæŒç»­æ›´æ–°ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥ç‚¹ä¸ªæ”¶è—ï¼Œé˜²æ­¢è¿·è·¯ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œso ,Let's go!!!</p> <h2 id="ç»„ä»¶é€šä¿¡"><a href="#ç»„ä»¶é€šä¿¡" class="header-anchor">#</a> ç»„ä»¶é€šä¿¡</h2> <h3 id="props"><a href="#props" class="header-anchor">#</a> props</h3> <p>é€‚ç”¨äºçˆ¶å­ç»„ä»¶é€šä¿¡</p> <h4 id="çˆ¶ç»„ä»¶-å­ç»„ä»¶"><a href="#çˆ¶ç»„ä»¶-å­ç»„ä»¶" class="header-anchor">#</a> çˆ¶ç»„ä»¶-&gt;å­ç»„ä»¶</h4> <p>çˆ¶ç»„ä»¶å°†éœ€è¦ä¼ é€’çš„å‚æ•°é€šè¿‡<code>key={xxx}</code>æ–¹å¼ä¼ é€’è‡³å­ç»„ä»¶ï¼Œå­ç»„ä»¶é€šè¿‡<code>this.props.key</code>è·å–å‚æ•°.</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./son'</span>
<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handleChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">'çˆ¶ç»„ä»¶'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>text<span class="token punctuation">'</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token attr-name">info</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father

<span class="token comment">// å­ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>
  info<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component<span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son
</code></pre></div><h4 id="å­ç»„ä»¶-çˆ¶ç»„ä»¶"><a href="#å­ç»„ä»¶-çˆ¶ç»„ä»¶" class="header-anchor">#</a> å­ç»„ä»¶-&gt;çˆ¶ç»„ä»¶</h4> <p>åˆ©ç”¨ props callback é€šä¿¡ï¼Œçˆ¶ç»„ä»¶ä¼ é€’ä¸€ä¸ª callback åˆ°å­ç»„ä»¶ï¼Œå½“äº‹ä»¶è§¦å‘æ—¶å°†å‚æ•°æ”¾ç½®åˆ° callback å¸¦å›ç»™çˆ¶ç»„ä»¶.</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// çˆ¶ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./son'</span>
<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ­¤å¤„çš„valueä¾¿æ˜¯å­ç»„ä»¶å¸¦å›</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info<span class="token operator">:</span> value<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token attr-name">callback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>callback<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father

<span class="token comment">// å­ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component<span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handleChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// åœ¨æ­¤å¤„å°†å‚æ•°å¸¦å›</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>text<span class="token punctuation">'</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son
</code></pre></div><h3 id="context"><a href="#context" class="header-anchor">#</a> Context</h3> <p>é€‚ç”¨äºè·¨å±‚çº§ç»„ä»¶ä¹‹é—´é€šä¿¡</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// context.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Consumer<span class="token punctuation">,</span> Provider <span class="token punctuation">}</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">//åˆ›å»º context å¹¶æš´éœ²Consumerå’ŒProvide</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> Consumer<span class="token punctuation">,</span> Provider <span class="token punctuation">}</span>

<span class="token comment">// çˆ¶ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./son'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./context'</span>
<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">'info from father'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father

<span class="token comment">// å­ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> GrandSon <span class="token keyword">from</span> <span class="token string">'./grandson'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Consumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./context'</span>
<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token comment">// é€šè¿‡Consumerç›´æ¥è·å–çˆ¶ç»„ä»¶çš„å€¼</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">çˆ¶ç»„ä»¶çš„å€¼:</span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GrandSon</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Consumer</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son

<span class="token comment">// å­™å­ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Consumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./context'</span>
<span class="token keyword">class</span> <span class="token class-name">GrandSon</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token comment">// é€šè¿‡ Consumer ä¸­å¯ä»¥ç›´æ¥è·å–ç»„çˆ¶ç»„ä»¶çš„å€¼</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">ç»„çˆ¶ç»„ä»¶çš„å€¼:</span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Consumer</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> GrandSon
</code></pre></div><p>ç‰¹åˆ«æ³¨æ„</p> <blockquote><p>å¦‚æœéœ€è¦æ¶ˆè´¹å¤šä¸ª Context,åˆ™ React éœ€è¦ä½¿æ¯ä¸€ä¸ª consumer ç»„ä»¶çš„ context åœ¨ç»„ä»¶æ ‘ä¸­æˆä¸ºä¸€ä¸ªå•ç‹¬çš„èŠ‚ç‚¹ã€‚</p></blockquote> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// provider</span>
<span class="token operator">...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Context1.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Context2.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Context2.Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Context1.Provider</span></span><span class="token punctuation">&gt;</span></span>

 <span class="token comment">// consumer</span>
 <span class="token operator">...</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Context1.Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">info<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
      <span class="token comment">// é€šè¿‡Consumerç›´æ¥è·å–çˆ¶ç»„ä»¶çš„å€¼</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Context2.Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">theme<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">çˆ¶ç»„ä»¶infoçš„å€¼:</span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">çˆ¶ç»„ä»¶themeçš„å€¼:</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Context2.Consumer</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Context1.Consumer</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>å¾ˆå¤šä¼˜ç§€çš„ React ç»„ä»¶çš„æ ¸å¿ƒåŠŸèƒ½éƒ½é€šè¿‡ Context æ¥å®ç°çš„ï¼Œæ¯”å¦‚ react-redux å’Œ react-router ç­‰ï¼Œæ‰€ä»¥æŒæ¡ Context æ˜¯å¿…é¡»çš„ã€‚</p></blockquote> <h3 id="onref"><a href="#onref" class="header-anchor">#</a> OnRef</h3> <p>OnRef çš„åŸç†å¾ˆç®€å•ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡ props å°†å­ç»„ä»¶çš„ç»„ä»¶å®ä¾‹ï¼ˆä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„ thisï¼‰å½“ä½œå‚æ•°ï¼Œé€šè¿‡å›è°ƒä¼ åˆ°çˆ¶ç»„ä»¶ï¼Œç„¶ååœ¨çˆ¶ç»„ä»¶å°±å¯ä»¥æ‹¿åˆ°å­ç»„ä»¶çš„å®ä¾‹ï¼Œæ‹¿åˆ°äº†å®ƒçš„å®ä¾‹å°±å¯ä»¥è°ƒç”¨å®ƒçš„æ–¹æ³•ï¼ˆ<s>ä¸ºæ‰€æ¬²ä¸º</s>ï¼‰äº†ã€‚</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// çˆ¶ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./son'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  child<span class="token operator">:</span> <span class="token builtin">any</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">sonRef</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>child <span class="token operator">=</span> ref <span class="token comment">// åœ¨è¿™é‡Œæ‹¿åˆ°å­ç»„ä»¶çš„å®ä¾‹</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">clearSonInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">.</span><span class="token function">clearInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token attr-name">onRef</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>sonRef<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>primary<span class="token punctuation">'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>clearSonInput<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          æ¸…ç©ºå­ç»„ä»¶çš„input
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father

<span class="token comment">// å­ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>
  onRef<span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component<span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onRef</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// åœ¨è¿™å°†å­ç»„ä»¶çš„å®ä¾‹ä¼ é€’ç»™çˆ¶ç»„ä»¶this.props.onRef()æ–¹æ³•</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">'son'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">clearInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>text<span class="token punctuation">'</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son
</code></pre></div><h3 id="ref"><a href="#ref" class="header-anchor">#</a> ref</h3> <p><code>ref</code>æ˜¯<code>react</code>æä¾›ç»™æˆ‘ä»¬çš„ä¸€ä¸ªå±æ€§,é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—® <code>DOM</code> èŠ‚ç‚¹æˆ–è€…ç»„ä»¶.</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// çˆ¶ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./son'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  son<span class="token operator">:</span> <span class="token builtin">any</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>son <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// åœ¨æ­¤å¤„åˆ›å»ºref</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">clearSonInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> current <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>son <span class="token comment">// æ³¨æ„ï¼Œè¿™é‡Œå¿…é¡»é€šè¿‡ this.son.currentæ‹¿åˆ°å­ç»„ä»¶çš„å®ä¾‹</span>
    current<span class="token punctuation">.</span><span class="token function">clearInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>son<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>primary<span class="token punctuation">'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>clearSonInput<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          æ¸…ç©ºå­ç»„ä»¶çš„input
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father

<span class="token comment">// å­ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">'son'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">clearInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>text<span class="token punctuation">'</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son
</code></pre></div><blockquote><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡ <code>this.childRef.current</code>æ‰èƒ½æ‹¿åˆ°å­ç»„ä»¶çš„å®ä¾‹ã€‚<br>
ä½¿ç”¨ ref å¸¸è§çš„åœºæ™¯æœ‰ç®¡ç†ç„¦ç‚¹ï¼Œæ–‡æœ¬é€‰æ‹©æˆ–åª’ä½“æ’­æ”¾ã€è§¦å‘å¼ºåˆ¶åŠ¨ç”»ã€é›†æˆç¬¬ä¸‰æ–¹ DOM åº“ç­‰ã€‚</p></blockquote> <h3 id="ç¬¬ä¸‰æ–¹å·¥å…·"><a href="#ç¬¬ä¸‰æ–¹å·¥å…·" class="header-anchor">#</a> ç¬¬ä¸‰æ–¹å·¥å…·</h3> <h4 id="events-å‘å¸ƒè®¢é˜…"><a href="#events-å‘å¸ƒè®¢é˜…" class="header-anchor">#</a> events(å‘å¸ƒè®¢é˜…)</h4> <p>è¿™ç§æ–¹å¼é€‚ç”¨äºæ²¡æœ‰ä»»ä½•åµŒå¥—å…³ç³»çš„ç»„ä»¶é€šä¿¡ã€‚å…¶åŸç†å°±æ˜¯ä½¿ç”¨äº‹ä»¶è®¢é˜…ã€‚å³æ˜¯ä¸€ä¸ªå‘å¸ƒè€…ï¼Œä¸€ä¸ªæˆ–è€…å¤šä¸ªè®¢é˜…è€…ã€‚
ä½¿ç”¨ä¹‹å‰éœ€è¦å…ˆå®‰è£…:</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add events
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// event.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EventEmitter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'events'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// å‘å¸ƒè€… é€šè¿‡emitäº‹ä»¶è§¦å‘æ–¹æ³•ï¼Œå‘å¸ƒè®¢é˜…æ¶ˆæ¯ç»™è®¢é˜…è€…</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">'./son1'</span>
<span class="token keyword">import</span> Son2 <span class="token keyword">from</span> <span class="token string">'./son2'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> emitter <span class="token keyword">from</span> <span class="token string">'./event'</span>

<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  son<span class="token operator">:</span> <span class="token builtin">any</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//emitäº‹ä»¶è§¦å‘æ–¹æ³•,é€šè¿‡äº‹ä»¶åç§°æ‰¾å¯¹åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°infoï¼Œå°†äº‹ä»¶å¤„ç†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥</span>
    emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token string">'æˆ‘æ˜¯æ¥è‡ªfatherçš„ info'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>primary<span class="token punctuation">'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          ç‚¹å‡»æŒ‰é’®å‘å¸ƒäº‹ä»¶
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son2</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father

<span class="token comment">// è®¢é˜…è€…1</span>
<span class="token comment">// é€šè¿‡emitter.addListener(äº‹ä»¶åç§°,å‡½æ•°å)æ–¹æ³•ï¼Œè¿›è¡Œäº‹ä»¶ç›‘å¬(è®¢é˜…)ã€‚</span>
<span class="token comment">// é€šè¿‡emitter.removeListener(äº‹ä»¶åç§°,å‡½æ•°å)æ–¹æ³• ï¼Œè¿›è¡Œäº‹ä»¶é”€æ¯(å–æ¶ˆè®¢é˜…)</span>

<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> emitter <span class="token keyword">from</span> <span class="token string">'./event'</span>

<span class="token keyword">class</span> <span class="token class-name">Son1</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åœ¨ç»„ä»¶æŒ‚è½½å®Œæˆåå¼€å§‹ç›‘å¬</span>
    emitter<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        info<span class="token operator">:</span> <span class="token string">'Son1æ”¶åˆ°æ¶ˆæ¯--'</span> <span class="token operator">+</span> info<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç»„ä»¶é”€æ¯å‰ç§»é™¤äº‹ä»¶ç›‘å¬</span>
    emitter<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        info<span class="token operator">:</span> <span class="token string">'Son1å³å°†ç§»é™¤äº‹ä»¶ç›‘å¬--'</span> <span class="token operator">+</span> info<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son1

<span class="token comment">// è®¢é˜…è€…2</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> emitter <span class="token keyword">from</span> <span class="token string">'./event'</span>

<span class="token keyword">class</span> <span class="token class-name">Son2</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åœ¨ç»„ä»¶æŒ‚è½½å®Œæˆåå¼€å§‹ç›‘å¬</span>
    emitter<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        info<span class="token operator">:</span> <span class="token string">'Son2æ”¶åˆ°æ¶ˆæ¯--'</span> <span class="token operator">+</span> info<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç»„ä»¶é”€æ¯å‰ç§»é™¤äº‹ä»¶ç›‘å¬</span>
    emitter<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        info<span class="token operator">:</span> <span class="token string">'Son2å³å°†ç§»é™¤äº‹ä»¶ç›‘å¬--'</span> <span class="token operator">+</span> info<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son2
</code></pre></div><h2 id="è·¯ç”±"><a href="#è·¯ç”±" class="header-anchor">#</a> è·¯ç”±</h2> <p>éšç€å‰ç«¯å·¥ç¨‹çš„å¤æ‚åº¦è¶Šæ¥è¶Šé«˜ï¼Œæ‰€ä»¥è·¯ç”±ç®¡ç†åœ¨ç°åœ¨çš„å‰ç«¯å·¥ç¨‹ä¸­ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹ï¼Œ<code>vue</code>æä¾›äº†<code>vue-router</code>æ¥ç®¡ç†è·¯ç”±ã€‚ç›¸ä¼¼çš„ï¼Œ<code>react</code>åˆ™æä¾›äº†<code>react-router</code>æ¥ç®¡ç†è·¯ç”±ã€‚</p> <h3 id="react-router"><a href="#react-router" class="header-anchor">#</a> <code>react-router</code></h3> <p><code>react-router</code> åŒ…å« <code>3</code> ä¸ªï¼Œåˆ†åˆ«ä¸º<code>react-router</code>ã€<code>react-router-dom</code> å’Œ <code>react-router-native</code>ã€‚</p> <p><code>react-router</code>æä¾›æœ€åŸºæœ¬çš„è·¯ç”±åŠŸèƒ½ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬ä¸ä¼šç›´æ¥å®‰è£… <code>react-router</code>ï¼Œè€Œæ˜¯æ ¹æ®åº”ç”¨è¿è¡Œçš„ç¯å¢ƒæ¥é€‰æ‹©å®‰è£… <code>react-router-dom</code>å’Œ<code>react-router-native</code>ã€‚å› ä¸º<code>react-router-dom</code> å’Œ <code>react-router-native</code> éƒ½ä¾èµ– <code>react-router</code>ï¼Œæ‰€ä»¥åœ¨å®‰è£…æ—¶ï¼Œ<code>react-router</code> ä¹Ÿä¼šâ¾ƒè‡ªåŠ¨å®‰è£…ã€‚</p> <p>å…¶ä¸­<code>react-router-dom</code> åœ¨æµè§ˆå™¨å™¨ä¸­ä½¿â½¤ï¼Œè€Œ<code>react-router-native</code>åœ¨ <code>react-native</code> ä¸­ä½¿ç”¨ã€‚</p> <p>åœ¨ react-router é‡Œé¢ï¼Œä¸€å…±æœ‰ 3 ç§åŸºç¡€ç»„ä»¶ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯</p> <ul><li>è·¯ç”±ç»„ä»¶(router components) æ¯”å¦‚ <code>&lt;BrowserRouter&gt;</code> å’Œ <code>&lt;HashRouter&gt;</code></li> <li>è·¯ç”±åŒ¹é…ç»„ä»¶(route matchers components) æ¯”å¦‚ <code>&lt;Route&gt;</code> å’Œ <code>&lt;Switch&gt;</code></li> <li>å¯¼èˆªç»„ä»¶(navigation components) æ¯”å¦‚ <code>&lt;Link&gt;</code>, <code>&lt;NavLink&gt;</code>, å’Œ <code>&lt;Redirect&gt;</code></li></ul> <h3 id="è·¯ç”±ç»„ä»¶"><a href="#è·¯ç”±ç»„ä»¶" class="header-anchor">#</a> è·¯ç”±ç»„ä»¶</h3> <p>å¯¹äº web é¡¹ç›®ï¼Œreact-roruter-dom æä¾›äº† <code>&lt;BrowserRouter&gt;</code> å’Œ <code>&lt;HashRouter&gt;</code>ä¸¤ä¸ªè·¯ç”±ç»„ä»¶ã€‚</p> <ul><li><code>BrowserRouter</code>ï¼šæµè§ˆå™¨çš„è·¯ç”±æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ <code>HTML5</code> æä¾›çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History" target="_blank" rel="noopener noreferrer"><code>history API</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ( pushState , replaceState å’Œ popstate äº‹ä»¶) æ¥ä¿æŒ <code>UI</code> å’Œ <code>url</code> çš„åŒæ­¥ã€‚è¿™ç§æ–¹å¼åœ¨<code>react</code>å¼€å‘ä¸­æ˜¯ç»å¸¸ä½¿ç”¨çš„è·¯ç”±æ–¹å¼ï¼Œä½†æ˜¯åœ¨æ‰“åŒ…åï¼Œæ‰“å¼€ä¼šå‘ç°è®¿é—®ä¸äº†é¡µé¢ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡é…ç½® <code>nginx</code> è§£å†³æˆ–è€…åå°é…ç½®ä»£ç†ã€‚</li> <li><code>HashRouter</code>ï¼šåœ¨è·¯å¾„å‰åŠ å…¥#å·æˆä¸ºä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œ<code>Hash</code> æ¨¡å¼çš„å¥½å¤„æ˜¯ï¼Œå†ä¹Ÿä¸ä¼šå› ä¸ºæˆ‘ä»¬åˆ·æ–°è€Œæ‰¾ä¸åˆ°æˆ‘ä»¬çš„å¯¹åº”è·¯å¾„ï¼Œä½†æ˜¯é“¾æ¥ä¸Šé¢ä¼šæœ‰<code>#/</code>ã€‚åœ¨<code>vue</code>å¼€å‘ä¸­ï¼Œç»å¸¸ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚</li></ul> <p>è¦ä½¿ç”¨è·¯ç”±ç»„ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦ç¡®ä¿å®ƒæ˜¯åœ¨æ ¹ç»„ä»¶ä½¿ç”¨ï¼Œæˆ‘ä»¬åº”è¯¥å°†<code>&lt;App /&gt;</code>åŒ…è£¹åœ¨è·¯ç”±ç»„ä»¶ä¸‹é¢ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">&gt;</span></span>
<span class="token operator">...</span>
</code></pre></div><h3 id="åŒ¹é…ç»„ä»¶"><a href="#åŒ¹é…ç»„ä»¶" class="header-anchor">#</a> åŒ¹é…ç»„ä»¶</h3> <p>æœ‰ä¸¤ç§è·¯ç”±åŒ¹é…ç»„ä»¶ï¼š<code>&lt;Route&gt;</code> å’Œ <code>&lt;Switch&gt;</code></p> <p>è¿™ä¸¤ä¸ªè·¯ç”±åŒ¹é…ç»„ä»¶é€šå¸¸åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œåœ¨<code>&lt;Switch&gt;</code>é‡Œé¢åŒ…è£¹å¤šä¸ª<code>&lt;Route&gt;</code>ï¼Œç„¶åå®ƒä¼šé€æ­¥å»æ¯”å¯¹æ¯ä¸ª<code>&lt;Route&gt;</code>çš„<code>path</code>å±æ€§ å’Œæµè§ˆå™¨å½“å‰<code>location</code>çš„<code>pathname</code>æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™è¿”å›å†…å®¹ï¼Œå¦åˆ™è¿”å›<code>null</code>ã€‚</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">exact</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/<span class="token punctuation">'</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span><span class="token comment">/* å¦‚æœå½“å‰çš„URLæ˜¯`/about`,å³ location = { pathname: '/about' } ,é‚£ä¹ˆAboutç»„ä»¶å°±åº”è¯¥è¢«æ¸²æŸ“ï¼Œå…¶ä½™çš„Routeå°±ä¼šè¢«å¿½ç•¥ */</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/about<span class="token punctuation">'</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>About<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/contact<span class="token punctuation">'</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Contact<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>å€¼å¾—æ³¨æ„ âš ï¸ çš„æ˜¯ï¼š <code>&lt;Route path={xxx}&gt;</code> åªä¼šåŒ¹é… <code>URL</code>çš„å¼€å¤´ï¼Œè€Œä¸æ˜¯æ•´ä¸ª URLã€‚ç®€å•çš„æ¥è¯´å°±æ˜¯å®ƒä¸æ˜¯ç²¾ç¡®åŒ¹é… ï¼Œä¾‹å¦‚<code>&lt;Route path ='/'&gt;</code> å’Œ<code>&lt;Route path ='/about'&gt;</code> å®ƒæ°¸è¿œéƒ½åªèƒ½åŒ¹é…åˆ°<code>&lt;Route path ='/'&gt;</code>,ä»–ä»¬å¼€å¤´éƒ½æœ‰'/'ã€‚<br>
åœ¨è¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š</p> <ul><li>å°†æ­¤<code>&lt;Route path='/'&gt;</code>æ”¾åœ¨<code>&lt;Switch&gt;</code>çš„æœ€åä¸€ä¸ªä½ç½®</li> <li>å¦ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯æ·»åŠ 'exact' å®ç°ç²¾ç¡®åŒ¹é…ï¼š <code>&lt;Route exact='/'&gt;</code></li></ul> <p>æ‰€ä»¥<code>&lt;Switch&gt;</code>ç»„ä»¶åªä¼š <code>render</code> ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„è·¯ç”±ï¼Œåƒä¸Šé¢æˆ‘ä»¬è¯´çš„ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½® <code>path</code>ï¼Œåˆ™ä¸€å®šä¼šåŒ¹é…ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥å®ç° 404 çš„åŠŸèƒ½:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">exact</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/<span class="token punctuation">'</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/about<span class="token punctuation">'</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>About<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/contact<span class="token punctuation">'</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Contact<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span><span class="token comment">/* å½“ä¸Šé¢çš„ç»„ä»¶éƒ½æ²¡æœ‰åŒ¹é…åˆ°çš„æ—¶å€™, 404é¡µé¢ å°±ä¼šè¢« render */</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> 404é¡µé¢ </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="å¯¼èˆªç»„ä»¶"><a href="#å¯¼èˆªç»„ä»¶" class="header-anchor">#</a> å¯¼èˆªç»„ä»¶</h3> <p>å¯¼èˆªç»„ä»¶æœ‰<code>&lt;Link&gt;</code>, <code>&lt;NavLink&gt;</code>, å’Œ <code>&lt;Redirect&gt;</code>ã€‚</p> <p>å½“æˆ‘ä»¬ä½¿ç”¨<code>&lt;Link&gt;</code>çš„æ—¶å€™ï¼Œåœ¨ html é¡µé¢ä¼šè¢«æ¸²æŸ“ä¸ºä¸€ä¸ª<code>a</code>æ ‡ç­¾:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Home</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">// &lt;a href='/'&gt;Home&lt;/a&gt;</span>
</code></pre></div><p><code>&lt;NavLink&gt;</code>æ˜¯ä¸€ç§ç‰¹æ®Šçš„<code>&lt;Link&gt;</code> ï¼Œå½“<code>&lt;NavLink&gt;</code>ä¸­çš„åœ°å€å’Œæµè§ˆå™¨åœ°å€åŒ¹é…æˆåŠŸçš„æ—¶å€™ï¼Œä¼šæ·»åŠ ä¸€ä¸ª style æ ·å¼ï¼Œå¦‚ä¸‹ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/about<span class="token punctuation">'</span></span> <span class="token attr-name">activeClassName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>active<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  About
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavLink</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>åœ¨ html é¡µé¢å½“ä¸­ï¼Œå®ƒä¼šè¢«æ¸²æŸ“ä¸º:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/about<span class="token punctuation">'</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>active<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  About
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>ä½†æ˜¯æœ‰æ—¶ä½ å¯èƒ½æƒ³è¦å¼ºåˆ¶è·³è½¬åˆ°æŸä¸ªé¡µé¢ï¼Œæ¯”å¦‚æœªç™»å½•ä¸èƒ½è¿›å…¥é¦–é¡µï¼Œè¿™ä¸ªæ—¶å€™ä½ å¯ä»¥ä½¿ç”¨<code>&lt;Redirect&gt;</code></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Redirect</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>/login<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h2 id="çŠ¶æ€ç®¡ç†"><a href="#çŠ¶æ€ç®¡ç†" class="header-anchor">#</a> çŠ¶æ€ç®¡ç†</h2> <p>å‰ç«¯å·¥ç¨‹çš„å¤æ‚åº¦è¶Šæ¥è¶Šé«˜ï¼ŒçŠ¶æ€ç®¡ç†ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ç‚¹ã€‚åœ¨ react ç”Ÿæ€ä¸­ï¼Œç°åœ¨æœ€ç«çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå°±æ˜¯<code>redux</code>ã€‚</p> <h3 id="redux"><a href="#redux" class="header-anchor">#</a> redux</h3> <p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œreact æ˜¯å•å‘çš„æ•°æ®æµï¼Œæ•°æ®å‡ ä¹éƒ½æ˜¯é€šè¿‡ props ä¾æ¬¡ä»ä¸Šå¾€ä¸‹ä¼ :
<img src="https://i.loli.net/2020/05/25/EbvnGP2CflwQOoc.gif" alt="react-porps.gif"></p> <blockquote><p>å›¾ç‰‡æ¥è‡ª <a href="https://medium.com/dailyjs/when-do-i-know-im-ready-for-redux-f34da253c85f" target="_blank" rel="noopener noreferrer">When do I know Iâ€™m ready for Redux?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>ä¸€ä¸ªç»„ä»¶çš„çŠ¶æ€æœ‰ä¸¤ç§æ–¹å¼æ”¹å˜ï¼š</p> <ul><li>æ¥è‡ªçˆ¶ç»„ä»¶çš„ props æ”¹å˜äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªç»„ä»¶ä¹Ÿä¼šé‡æ–°æ¸²æŸ“</li> <li>è‡ªèº«æœ‰ stateï¼Œè‡ªèº«çš„ state å¯ä»¥é€šè¿‡<code>this.setstate</code>æ–¹æ³•æ”¹å˜</li></ul> <p>ç°åœ¨å‡å¦‚æˆ‘ä»¬ç»„ä»¶æ ‘çš„å±‚çº§æ¯”è¾ƒæ·±ï¼Œæœ‰å¾ˆå¤šå­ç»„ä»¶éœ€è¦å…±äº«çŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªèƒ½é€šè¿‡çŠ¶æ€æå‡æ¥æ”¹å˜çŠ¶æ€ï¼Œå°†çŠ¶æ€æå‡åˆ°é¡¶çº§çˆ¶ç»„ä»¶æ”¹å˜ï¼Œå½“é¡¶çº§çˆ¶ç»„ä»¶çš„çŠ¶æ€æ”¹å˜äº†ï¼Œé‚£ä¹ˆæ——ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½ä¼šé‡æ–°æ¸²æŸ“ï¼š</p> <p><img src="https://i.loli.net/2020/05/25/Po9KNkScQt1EwFR.gif" alt="state-change.gif"></p> <p>å½“å‡ºç°è¿™ç§æƒ…å†µå½“æ—¶å€™ï¼Œä½ å°±è¯¥ä½¿ç”¨<code>redux</code>äº†ã€‚é‚£ä¹ˆä½¿ç”¨<code>redux</code>ä¹‹åï¼Œå°±ä¼šå˜æˆè¿™æ ·ï¼š</p> <p><img src="https://i.loli.net/2020/05/25/hQO2eZsGdLa6gRq.gif" alt="redux-state.gif"></p> <p>ä»¥ä¸Š gif åŠ¨å›¾å¾ˆç”ŸåŠ¨çš„å±•ç¤ºäº† redux è§£å†³çš„é—®é¢˜ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹ redux ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼š</p> <h4 id="store"><a href="#store" class="header-anchor">#</a> Store</h4> <p>åœ¨ redux é‡Œé¢ï¼Œåªæœ‰ä¸€ä¸ª<code>Store</code>ï¼Œæ•´ä¸ªåº”ç”¨éœ€è¦ç®¡ç†çš„æ•°æ®éƒ½åœ¨è¿™ä¸ª<code>Store</code>é‡Œé¢ã€‚è¿™ä¸ª<code>Store</code>æˆ‘ä»¬ä¸èƒ½ç›´æ¥å»æ”¹å˜ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡è¿”å›ä¸€ä¸ªæ–°çš„<code>Store</code>å»æ›´æ”¹å®ƒã€‚<code>redux</code>æä¾›äº†ä¸€ä¸ª<code>createStore</code>æ¥åˆ›å»º<code>state</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
</code></pre></div><h4 id="action"><a href="#action" class="header-anchor">#</a> action</h4> <p>è¿™ä¸ª <code>action</code> æŒ‡çš„æ˜¯è§†å›¾å±‚å‘èµ·çš„ä¸€ä¸ªæ“ä½œï¼Œå‘Šè¯‰<code>Store</code> æˆ‘ä»¬éœ€è¦æ”¹å˜ã€‚æ¯”å¦‚ç”¨æˆ·ç‚¹å‡»äº†æŒ‰é’®ï¼Œæˆ‘ä»¬å°±è¦å»è¯·æ±‚åˆ—è¡¨ï¼Œåˆ—è¡¨çš„æ•°æ®å°±ä¼šå˜æ›´ã€‚æ¯ä¸ª <code>action</code> å¿…é¡»æœ‰ä¸€ä¸ª <code>type</code> å±æ€§ï¼Œè¿™è¡¨ç¤º <code>action</code> çš„åç§°ï¼Œç„¶åè¿˜å¯ä»¥æœ‰ä¸€ä¸ª <code>payload</code> å±æ€§ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥å¸¦ä¸€äº›å‚æ•°ï¼Œç”¨ä½œ <code>Store</code> å˜æ›´ï¼š</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'ADD_ITEM'</span><span class="token punctuation">,</span>
  payload<span class="token operator">:</span> <span class="token string">'new item'</span><span class="token punctuation">,</span> <span class="token comment">// å¯é€‰å±æ€§</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šé¢è¿™ä¸ªä¾‹å­å°±å®šä¹‰äº†ä¸€ä¸ªåä¸º<code>ADD_ITEM</code>çš„<code>Action</code>ï¼Œå®ƒè¿˜æºå¸¦äº†ä¸€ä¸ª<code>payload</code>çš„å‚æ•°ã€‚
<code>Redux</code> å¯ä»¥ç”¨ <code>Action Creator</code> æ‰¹é‡æ¥ç”Ÿæˆä¸€äº› <code>Action</code>ã€‚</p> <h4 id="reducer"><a href="#reducer" class="header-anchor">#</a> reducer</h4> <p>åœ¨ä¸Šé¢æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>Action</code>,ä½†æ˜¯<code>Action</code>ä¸ä¼šè‡ªå·±ä¸»åŠ¨å‘å‡ºå˜æ›´æ“ä½œåˆ°<code>Store</code>ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå«<code>dispatch</code>çš„ä¸œè¥¿ï¼Œå®ƒä¸“é—¨ç”¨æ¥å‘å‡º<code>action</code>ï¼Œä¸è¿‡è¿˜å¥½ï¼Œè¿™ä¸ª<code>dispatch</code>ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å®šä¹‰å’Œå®ç°ï¼Œ<code>redux</code>å·²ç»å¸®æˆ‘ä»¬å†™å¥½äº†ï¼Œåœ¨<code>redux</code>é‡Œé¢ï¼Œ<code>store.dispatch()</code>æ˜¯ <code>View</code>å‘å‡º <code>Action</code> çš„å”¯ä¸€æ–¹æ³•ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'ADD_ITEM'</span><span class="token punctuation">,</span>
  payload<span class="token operator">:</span> <span class="token string">'new item'</span><span class="token punctuation">,</span> <span class="token comment">// å¯é€‰å±æ€§</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>å½“ <code>dispatch</code> å‘èµ·äº†ä¸€ä¸ª <code>action</code> ä¹‹åï¼Œä¼šåˆ°è¾¾ <code>reducer</code>ï¼Œé‚£ä¹ˆè¿™ä¸ª <code>reducer</code> ç”¨æ¥å¹²ä»€ä¹ˆå‘¢ï¼Ÿé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ª<code>reducer</code>å°±æ˜¯ç”¨æ¥è®¡ç®—æ–°çš„<code>store</code>çš„ï¼Œ<code>reducer</code>æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šå½“å‰çš„<code>state</code>å’Œæ¥æ”¶åˆ°çš„<code>action</code>ï¼Œç„¶åå®ƒç»è¿‡è®¡ç®—ï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°çš„<code>state</code>ã€‚(å‰é¢æˆ‘ä»¬å·²ç»è¯´è¿‡äº†ï¼Œä¸èƒ½ç›´æ¥æ›´æ”¹<code>state</code>ï¼Œå¿…é¡»é€šè¿‡è¿”å›ä¸€ä¸ªæ–°çš„<code>state</code>æ¥è¿›è¡Œå˜æ›´ã€‚)</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>prevState<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token keyword">return</span> newState<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>è¿™ä¸ª <code>reducer</code> æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚çº¯å‡½æ•°çš„æ„æ€æ˜¯è¯´ï¼Œå¯¹äºç›¸åŒçš„è¾“å…¥ï¼Œåªä¼šæœ‰ç›¸åŒçš„è¾“å‡ºï¼Œä¸ä¼šå½±å“å¤–éƒ¨çš„å€¼ï¼Œä¹Ÿä¸ä¼šè¢«å¤–éƒ¨çš„å€¼æ‰€å½±å“ã€‚çº¯å‡½æ•°å±äºå‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µï¼Œå¦‚æœä½ æƒ³äº†è§£æ›´å¤šçº¯å‡½æ•°çš„æ¦‚å¿µï¼Œè¯·çœ‹<a href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/ch3.html#%E8%BF%BD%E6%B1%82%E2%80%9C%E7%BA%AF%E2%80%9D%E7%9A%84%E7%90%86%E7%94%B1" target="_blank" rel="noopener noreferrer">è¿™é‡Œ
<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨åˆ›å»º<code>store</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨<code>createStore</code>é‡Œé¢ä¼ å…¥äº†ä¸€ä¸ª<code>reducer</code>å‚æ•°ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±æ˜¯ä¸ºäº†ï¼Œæ¯æ¬¡<code>store.dispatch</code>å‘é€ä¸€ä¸ªæ–°çš„<code>action</code>,<code>redux</code>éƒ½ä¼šè‡ªåŠ¨è°ƒç”¨<code>reducer</code>ï¼Œè¿”å›æ–°çš„<code>state</code>ã€‚</p> <p>é‚£ä¹ˆå½“é¡¹ç›®ç‰¹åˆ«å¤§ç‰¹åˆ«å¤æ‚çš„æ—¶å€™ï¼Œ<code>state</code> è‚¯å®šæ˜¯éå¸¸å¤§çš„ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†™å¾ˆå¤šä¸ª <code>reducer</code>ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠ <code>reducer</code> è¿›è¡Œæ‹†åˆ†ã€‚æ¯ä¸ª <code>reducer</code> åªè´Ÿè´£ç®¡ç† <code>state</code> çš„ä¸€éƒ¨åˆ†æ•°æ®ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ç»Ÿä¸€å¯¹è¿™äº› <code>reducer</code> è¿›è¡Œç®¡ç†å‘¢ï¼Ÿ<code>redux</code> ç»™æˆ‘ä»¬æä¾›äº† <code>combineReducers</code> æ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†æ‰€æœ‰çš„å­ <code>reducer</code> åˆæˆä¸€ä¸ª <code>reducer</code>ï¼Œæ–¹ä¾¿æˆ‘ä»¬ç®¡ç†ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> listReducer <span class="token keyword">from</span> <span class="token string">'./listReducer/reducers'</span>
<span class="token keyword">import</span> detailReducer <span class="token keyword">from</span> <span class="token string">'./detailReducer/reducers'</span>
<span class="token keyword">import</span> aboutReducer <span class="token keyword">from</span> <span class="token string">'./aboutReducer/reducers'</span>

<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  listReducer<span class="token punctuation">,</span>
  detailReducer<span class="token punctuation">,</span>
  aboutReducer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> rootReducer
</code></pre></div><h4 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="header-anchor">#</a> ä¸­é—´ä»¶</h4> <p>ç†Ÿæ‚‰<code>koa</code>çš„æœ‹å‹ä»¬ï¼Œåº”è¯¥çŸ¥é“ä¸­é—´ä»¶çš„æ¦‚å¿µã€‚ä¸­é—´ä»¶çš„æ„æ€ç®€å•ç†è§£å°±æ˜¯ï¼Œåœ¨æŸä¸¤ä¸ªæ“ä½œä¹‹é—´ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡ŒæŸäº›æ“ä½œã€‚é‚£ä¹ˆåœ¨ redux,æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å¼•å…¥ä¸­é—´ä»¶å‘¢ï¼Ÿåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ¥æ‹ä¸€ä¸‹æˆ‘ä»¬åˆšåˆšå·²ç»è¿›è¡Œçš„æ­¥éª¤ï¼š</p> <ol><li>åˆ›å»º store</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>å‘å‡º action</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'ADD_ITEM'</span><span class="token punctuation">,</span>
  payload<span class="token operator">:</span> <span class="token string">'new item'</span><span class="token punctuation">,</span> <span class="token comment">// å¯é€‰å±æ€§</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>reducer è®¡ç®—è¿”å›æ–°çš„ state</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>prevState<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token keyword">return</span> newState<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>æˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬è¿™æ¬¡å‘èµ·çš„å˜æ›´ï¼Œéƒ½æ˜¯åŒæ­¥æ“ä½œï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ã€‚å‡å¦‚æˆ‘ä»¬<code>state</code>é‡Œé¢æœ‰ä¸€ä¸ªåˆ—è¡¨ï¼š<code>list</code>ï¼Œç”¨æˆ·æ ¹æ®åœ¨<code>view</code>ä¸Šé¢ç‚¹å‡»äº†ä¸€äº›ç­›é€‰æ¡ä»¶ï¼Œå‘èµ·è¯·æ±‚ï¼Œç„¶åå˜æ›´<code>state</code>é‡Œé¢<code>list</code>çš„å€¼ã€‚åœ¨è¿™é‡Œï¼Œæœ‰å¼‚æ­¥è¯·æ±‚ï¼Œä½†æ˜¯æˆ‘ä»¬å˜æ›´ redux çš„è¿‡ç¨‹éƒ½æ˜¯åŒæ­¥çš„ï¼Œæ˜¾ç„¶æ˜¯ä¸æ”¯æŒå¼‚æ­¥çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç”¨åˆ°ä¸­é—´ä»¶äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å°†å¼‚æ­¥è¯·æ±‚æ”¾åœ¨ä»¥ä¸Šå“ªä¸ªæ­¥éª¤å»æ‰§è¡Œå‘¢ï¼Ÿæ˜¾ç„¶ç¬¬ 1 æ­¥å’Œç¬¬ 3 æ­¥ä¸å¯èƒ½ï¼Œå…¶ä¸­ç¬¬ 1 æ­¥åªæ˜¯åœ¨åˆ›å»º <code>store</code>ï¼Œç¬¬ 3 æ­¥ <code>reducer</code> æ˜¯çº¯å‡½æ•°ï¼Œæ ¹æœ¬ä¸å¯èƒ½åŠ å…¥å¼‚æ­¥æ“ä½œã€‚æ‰€ä»¥æˆ‘ä»¬å¾ˆè‡ªç„¶çš„æƒ³åˆ°ï¼Œå°±æ˜¯åœ¨ <code>store.dispatch</code> çš„ä¹‹åï¼Œåˆ°è¾¾<code>reducer</code>ä¹‹å‰è¿›è¡Œå¼‚æ­¥æ“ä½œï¼š</p> <div class="language-ts extra-class"><pre class="language-ts"><code>store<span class="token punctuation">.</span><span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>prevAction<span class="token punctuation">)</span> <span class="token keyword">async</span><span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å‘è¯·æ±‚å•¦&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œæˆä¹‹åæ‰æ´¾å‘action</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æŠŠ list æ”¾åˆ°actioné‡Œé¢</span>
  <span class="token keyword">const</span> newAction <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token operator">:</span> prevAction<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">,</span>
    payload<span class="token operator">:</span>list
  <span class="token punctuation">}</span>
  store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>newAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>å°±æ˜¯ç»™<code>store.dispatch</code>å†åŒ…è£¹ä¸€å±‚ï¼Œè¿™å°±æ˜¯ä¸­é—´ä»¶çš„åŸç†ã€‚
redux å¸¸è§çš„ä¸­é—´ä»¶æœ‰<code>redux-thunx</code>ã€<code>redux-promise</code>ã€<code>redux-saga</code>ã€‚ç›¸å…³çš„è¯¦ç»†ç”¨æ³•åœ¨è¿™é‡Œä¸å†èµ˜è¿°(ä¸‹é¢ä¼šä»‹ç»<code>dva-core</code>çš„ç”¨æ³•)ã€‚
redux åº”ç”¨ä¸­é—´ä»¶çš„æ–¹æ³•ï¼š</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> applyMiddleware<span class="token punctuation">,</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> myMiddleware <span class="token keyword">from</span> <span class="token string">'./myMiddleware'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>myMiddleware<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="é€šçŸ¥å˜æ›´"><a href="#é€šçŸ¥å˜æ›´" class="header-anchor">#</a> é€šçŸ¥å˜æ›´</h4> <p>é‚£ä¹ˆåˆ°è¿™ä¸€æ­¥äº†ï¼Œæˆ‘ä»¬å˜æ›´äº† <code>state</code>ï¼Œä¸‹ä¸€æ­¥æ˜¯å°†å˜æ›´é€šçŸ¥ç»™ <code>view</code> äº†ã€‚åœ¨ redux é‡Œé¢ï¼Œæä¾›äº†<code>store.subscribe(listener)</code>è¿™ä¸ªæ–¹æ³•,è¿™ä¸ªæ–¹æ³•ä¼ å…¥ä¸€ä¸ª<code>listener</code>,æ¯”å¦‚åœ¨ <code>react</code> é‡Œé¢ï¼Œ<code>listener</code>å¯ä»¥æ˜¯<code>this.setState(xxx)</code>,æ¯å½“ <code>redux</code> é‡Œé¢çš„<code>state</code>æ”¹å˜äº†ï¼Œé€šè¿‡<code>store.subscribe(listener)</code>æˆ‘ä»¬çš„é¡µé¢ä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚æ„æ€æ˜¯æˆ‘ä»¬æ¯ä¸ªé¡µé¢éƒ½å¾—æ‰‹åŠ¨å»<code>store.subscribe(listener)</code>ï¼Œè¿™ä¹Ÿå¤ªéº»çƒ¦äº†å§ï¼Œå¯¹å§ã€‚</p> <h3 id="react-redux-å’Œ-redux"><a href="#react-redux-å’Œ-redux" class="header-anchor">#</a> <code>react-redux</code> å’Œ <code>redux</code></h3> <p>ä¸ºäº†è§£å†³ä¸Šè¿°çš„ç—›ç‚¹é—®é¢˜ï¼Œæ›´å¥½çš„å°† <code>redux</code> å’Œ <code>react</code> ç»“åˆï¼Œå®˜æ–¹ç»™æˆ‘ä»¬æä¾›äº†<code>react-redux</code>è¿™ä¸ªåŒ…ï¼ˆå¯èƒ½ä½ åˆ°ç°åœ¨è„‘å­æœ‰ç‚¹ä¹±äº†ï¼Œæˆ‘åˆšå¼€å§‹ä¹Ÿæ˜¯ï¼‰ã€‚é‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®ä¸€ä¸ªæ¦‚å¿µï¼š<code>redux</code> å’Œ <code>react</code> æ˜¯ä¸¤ä¸ªå…«ç«¿å­ä¸ç€çš„äººã€‚<code>redux</code> åªæ˜¯ä¸€ä¸ªçŠ¶æ€ç®¡ç†æ¡†æ¶ï¼Œ<code>react</code> åªæ˜¯ä¸€ä¸ªå‰ç«¯åº”ç”¨æ¡†æ¶ã€‚<code>redux</code> å¯ä»¥ç”¨äºå‰ç«¯ä»»ä½•æ¡†æ¶ï¼Œä¾‹å¦‚ <code>vue</code>ï¼Œç”šè‡³çº¯ <code>javaScript</code> éƒ½å¯ä»¥ã€‚åæ¥ <code>react-redux</code> å‡ºç°äº†ï¼Œä»–æŠŠ <code>redux</code> å’Œ <code>react</code> æ’®åˆåœ¨ä¸€èµ·äº†ï¼Œäºæ˜¯ä»–ä»¬ä¸¤å¼ºå¼ºè”åˆï¼Œé£äº‘åˆç’§ï¼Œæ‰€å‘æŠ«é¡ï¼Œå¥½äº†ä¸æ‰¯äº†ã€‚è¯´äº†è¿™ä¹ˆå¤šå°±æ˜¯æƒ³è¯´æ˜ <code>react-redux</code> è¿™ä¸ªåŒ…çš„ä½œç”¨ã€‚</p> <p>åœ¨è¯¦ç»†è¯´æ˜<code>react-redux</code>çš„ä½œç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä»¥ä¸‹çŸ¥è¯†ç‚¹ï¼š
<code>react-redux</code>å°† react ç»„ä»¶åˆ’åˆ†ä¸º<code>å®¹å™¨ç»„ä»¶</code>å’Œ<code>å±•ç¤ºç»„ä»¶</code>ï¼Œå…¶ä¸­</p> <ul><li>å±•ç¤ºç»„ä»¶ï¼šåªæ˜¯è´Ÿè´£å±•ç¤º UIï¼Œä¸æ¶‰åŠåˆ°é€»è¾‘çš„å¤„ç†ï¼Œæ•°æ®æ¥è‡ªçˆ¶ç»„ä»¶çš„<code>props</code>;</li> <li>å®¹å™¨ç»„ä»¶ï¼šè´Ÿè´£é€»è¾‘ã€æ•°æ®äº¤äº’ï¼Œå°† state é‡Œé¢çš„æ•°æ®ä¼ é€’ç»™<code>å±•ç¤ºç»„ä»¶</code>è¿›è¡Œ UI å‘ˆç°</li></ul> <p>å®¹å™¨ç»„ä»¶æ˜¯<code>react-redux</code>æä¾›çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦è´Ÿè´£å±•ç¤ºç»„ä»¶ï¼Œ<code>react-redux</code>è´Ÿè´£çŠ¶æ€ç®¡ç†ã€‚</p> <p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>redux</code>æä¾›äº†ä¸€ä¸ªå¤§çš„<code>state</code>ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦é¢å¯¹ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•è®©æˆ‘ä»¬<code>react</code>é¡¹ç›®é‡Œé¢çš„æ‰€æœ‰ç»„ä»¶éƒ½èƒ½å¤Ÿæ‹¿åˆ°<code>state</code>ï¼Ÿï¼›ç¬¬äºŒä¸ªï¼Œæ¯å½“<code>state</code>å˜æ›´ä¹‹åï¼Œç»„ä»¶å¦‚ä½•æ”¶åˆ°å˜æ›´ä¿¡æ¯ï¼Ÿ</p> <h5 id="provider"><a href="#provider" class="header-anchor">#</a> <code>Provider</code></h5> <p>é’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œ<code>react-redux</code>æä¾›äº†<code>Provider</code>ç»„ä»¶ã€‚ç”¨è¿™ä¸ª<code>Provider</code>åŒ…è£¹æ ¹ç»„ä»¶ï¼Œå°†<code>redux</code>å¯¼å‡ºçš„<code>state</code>ï¼Œä½œä¸ºå‚æ•°å¾€ä¸‹é¢ä¼ </p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span><span class="token punctuation">;</span> <span class="token comment">// è¿™ä¸ªstoreç”±reduxå¯¼å‡º</span>
Â·Â·Â·
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
Â·Â·Â·
<span class="token keyword">return</span>
</code></pre></div><p>è¿™æ ·æ‰€æœ‰çš„ç»„ä»¶éƒ½èƒ½æ‹¿åˆ°<code>state</code>äº†ã€‚è¿™ä¸ª Provider ç»„ä»¶åŸç†å°±æ˜¯é€šè¿‡<code>react</code>çš„<code>Context</code>æ¥å®ç°çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹æºç :</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token keyword">const</span> Context <span class="token operator">=</span> context <span class="token operator">||</span> ReactReduxContext<span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Context.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Context.Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token punctuation">.</span>
</code></pre></div><p>è¿™é‡Œçš„<code>contextValue</code>å°±åŒ…è£¹äº†æˆ‘ä»¬ä¼ å…¥çš„<code>store</code>ï¼Œå¾ˆæ˜æ˜¾ï¼Œå®ƒåˆ›å»ºäº† Contextï¼Œé€šè¿‡<code>&lt;Context.Provider value={contextValue}&gt;{children}&lt;/Context.Provider&gt;</code>è¿™ç§æ–¹å¼å°†æˆ‘ä»¬ä¼ å…¥çš„<code>store</code>æä¾›ç»™äº†<code>react</code>æ‰€æœ‰ç»„ä»¶ã€‚</p> <h5 id="connect"><a href="#connect" class="header-anchor">#</a> <code>connect</code></h5> <p>åœ¨ä¸Šé¢æˆ‘ä»¬çŸ¥é“æ€ä¹ˆå°† redux æš´éœ²å‡ºæ¥çš„ state æä¾›ç»™ react ç»„ä»¶çš„ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨æŸä¸ªå­ç»„ä»¶é‡Œé¢å¦‚ä½•æ”¶åˆ° state çš„å˜æ›´å‘¢ï¼Ÿ<code>react-redux</code>ç»™æˆ‘ä»¬æä¾›äº†<code>connect</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥ä¼ å…¥ä¸¤ä¸ªå¯é€‰å‚æ•°:<code>mapStateToProps</code>å’Œ<code>mapDispatchToProps</code>ï¼Œç„¶åä¼šè¿”å›ä¸€ä¸ªå®¹å™¨ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶å¯ä»¥è‡ªåŠ¨ç›‘å¬åˆ° <code>state</code> çš„å˜æ›´ï¼Œå°† <code>state</code> çš„å€¼æ˜ å°„ä¸ºç»„ä»¶çš„ <code>props</code> å‚æ•°ï¼Œä¹‹åæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ <code>this.props</code> å–åˆ° <code>state</code> é‡Œé¢çš„å€¼ã€‚</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  goodsList<span class="token operator">:</span> state<span class="token punctuation">.</span>goodsList<span class="token punctuation">,</span>
  totalCount<span class="token operator">:</span> state<span class="token punctuation">.</span>totalCount<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  mapStateToProps<span class="token punctuation">,</span> <span class="token comment">// å¯é€‰</span>
<span class="token comment">// mapDispatchToProps, // å¯é€‰</span>
<span class="token punctuation">(</span>GoodsList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>mapStateToProps</code>å°±æ˜¯å°† state çš„å€¼æ˜ å°„ä¸ºç»„ä»¶çš„<code>props</code>ï¼Œ<code>mapDispatchToProps</code>å°±æ˜¯å°†<code>store.dispatch</code>æ˜ å°„ä¸º<code>props</code>ã€‚å¦‚æœæˆ‘ä»¬ä¸ä¼ <code>mapDispatchToProps</code>çš„è¯ï¼Œ<code>connect</code>ä¼šè‡ªåŠ¨å°† <code>dispatch</code> æ³¨å…¥åˆ° <code>props</code> é‡Œé¢ï¼Œæˆ‘ä»¬åœ¨ç»„ä»¶é‡Œå¯ä»¥ç›´æ¥é€šè¿‡<code>this.props.dispatch</code>å‘èµ·ä¸€ä¸ª<code>action</code>ç»™<code>reducer</code>ã€‚</p> <h3 id="connected-react-router-å’Œ-redux"><a href="#connected-react-router-å’Œ-redux" class="header-anchor">#</a> <code>connected-react-router</code> å’Œ <code>redux</code></h3> <p>å½“æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åŒæ—¶ç”¨äº†<code>react-router</code> å’Œ <code>redux</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä»–ä»¬ä¸¤ä¸ªæ·±åº¦æ•´åˆã€‚æˆ‘ä»¬æƒ³è¦åœ¨<code>store</code>é‡Œé¢æ‹¿åˆ°<code>router</code>ï¼Œç”šè‡³å¯ä»¥æ“ä½œ<code>router</code>ï¼Œè¿˜å¯ä»¥è®°å½•<code>router</code>çš„æ”¹å˜ã€‚ä¾‹å¦‚æˆ‘ä»¬æŠŠç”¨æˆ·æ˜¯å¦ç™»å½•çš„çŠ¶æ€å­˜åœ¨<code>redux</code>é‡Œé¢ï¼Œåœ¨ç™»å½•ä¹‹åä¼šè¿›è¡Œé¡µé¢çš„è·³è½¬ã€‚æ­£å¸¸çš„æ“ä½œæ˜¯æˆ‘ä»¬åœ¨å‘èµ·è¯·æ±‚ä¹‹åï¼Œå¾—åˆ°ä¸€ä¸ªçŠ¶æ€ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦<code>dispatch</code>ä¸€ä¸ª<code>action</code>å»æ”¹å˜<code>redux</code>çš„çŠ¶æ€ï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦è¿›è¡Œè·¯ç”±çš„è·³è½¬ï¼Œç±»ä¼¼äºè¿™æ ·:<code>store.dispatch(replace('/home'))</code>ã€‚æƒ³è¦å®ç°è¿™ç§æ·±åº¦æ•´åˆï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° <code>connected-react-router</code>å’Œ<code>history</code>ä¸¤ä¸ªåº“ã€‚</p> <p>é¦–å…ˆéœ€è¦<code>history</code>ç”Ÿæˆ<code>history</code>å¯¹è±¡ï¼Œç»“åˆ<code>connected-react-router</code>çš„<code>connectRouter</code>ç”Ÿæˆ<code>routerReducer</code>ï¼ŒåŒæ—¶åˆ©ç”¨<code>connected-react-router</code>çš„<code>routerMiddleware</code>å®ç°<code>dispatch action</code>å¯¼èˆªï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åˆšåˆšè¯´çš„<code>store.dispatch(replace('/home'))</code>:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// APP.tsx</span>
<span class="token keyword">const</span> createHistory <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'history'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBrowserHistory
<span class="token keyword">export</span> <span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">createHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// reducer/index.ts</span>
<span class="token keyword">const</span> routerReducer <span class="token operator">=</span> <span class="token function">connectRouter</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
<span class="token keyword">const</span> routerMiddlewareForDispatch <span class="token operator">=</span> <span class="token function">routerMiddleware</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
<span class="token keyword">const</span> middleware <span class="token operator">=</span> <span class="token punctuation">[</span>routerMiddlewareForDispatch<span class="token punctuation">]</span>
</code></pre></div><p>æ¥ç€åˆ©ç”¨<code>redux</code>çš„<code>combineReducers</code>å°†æˆ‘ä»¬è‡ªå·±çš„<code>reducer</code>å’Œ<code>routerReducer</code>åˆå¹¶èµ·æ¥ï¼Œç»„æˆ<code>rootReducer</code>ï¼Œç„¶ååˆ©ç”¨ <code>createStore</code>åˆ›å»º<code>store</code>å¹¶æš´éœ²å‡ºå»:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// reducer/index.ts</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">geneGrateSotore</span><span class="token punctuation">(</span><span class="token parameter">history<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> routerReducer <span class="token operator">=</span> <span class="token function">connectRouter</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
  <span class="token keyword">const</span> routerMiddlewareForDispatch <span class="token operator">=</span> <span class="token function">routerMiddleware</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
  <span class="token keyword">const</span> middleware <span class="token operator">=</span> <span class="token punctuation">[</span>routerMiddlewareForDispatch<span class="token punctuation">]</span>
  <span class="token comment">//åˆå¹¶routerReducer</span>
  <span class="token keyword">const</span> rootRuder <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    info<span class="token operator">:</span> infoRuder<span class="token punctuation">,</span>
    router<span class="token operator">:</span> routerReducer<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootRuder<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token operator">...</span>middleware<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> store
<span class="token punctuation">}</span>
</code></pre></div><p>æœ€åæˆ‘ä»¬åœ¨<code>App.tsx</code>å¯¼å…¥åˆšåˆšæˆ‘ä»¬åˆ›å»ºçš„è¿™ä¸ªæ–¹æ³•ï¼Œç”Ÿæˆ<code>store</code>,æ¥ç€å°†æˆ‘ä»¬åˆ›å»ºçš„<code>history</code>å¯¹è±¡ä¼ å…¥<code>connected-react-router</code>çš„<code>ConnectedRouter</code>ç»„ä»¶ä½œä¸º<code>props</code>ï¼Œå¹¶ç”¨å®ƒåŒ…è£¹æˆ‘ä»¬çš„<code>Router</code>ç»„ä»¶:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// App.tsx</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConnectedRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'connected-react-router'</span>
<span class="token keyword">import</span> geneGrateSotore <span class="token keyword">from</span> <span class="token string">'./store'</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'./router'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">const</span> createHistory <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'history'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBrowserHistory
<span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">createHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">geneGrateSotore</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>

<span class="token keyword">const</span> f<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ConnectedRouter</span></span> <span class="token attr-name">history</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Router</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Router</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ConnectedRouter</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> f
</code></pre></div><p>è¿™æ ·æˆ‘ä»¬å°±å°†<code>connected-react-router</code> å’Œ <code>redux</code>æ•´åˆèµ·æ¥äº†ã€‚ç°åœ¨å½“æˆ‘ä»¬åœ¨<code>View</code>åˆ©ç”¨<code>Link</code>è¿›è¡Œè·¯ç”±è·³è½¬çš„æ—¶å€™ï¼Œä¼šé€šè¿‡<code>react-router-dom</code>è¿›è¡Œè·¯ç”±è·³è½¬ï¼Œå¹¶ä¸”ä¹Ÿä¼šé€šè¿‡<code>connected-react-router</code>å‘èµ·ä¸€ä¸ª<code>action</code>å»æ›´æ–°<code>redux state</code>é‡Œé¢çš„<code>router</code>å¯¹è±¡ï¼Œä»¥è®°å½•è·¯ç”±çš„å˜åŒ–ã€‚åŒæ—¶ç°åœ¨æˆ‘ä»¬åœ¨çŠ¶æ€ç®¡ç†çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡<code>connected-react-router</code>æä¾›çš„<code>push</code>ã€<code>replace</code>ç­‰æ–¹æ³•äº†ï¼Œä»–ä»¬æ˜¯ä» <code>redux</code> å‡ºå‘ï¼Œä¹Ÿå°±æ˜¯è¯´å…ˆå‘èµ·ä¸€ä¸ª<code>action</code>ï¼Œç„¶åå†è¿›è¡Œè·¯ç”±è·³è½¬ã€‚</p> <h3 id="å°ç»“ä¸€ä¸‹"><a href="#å°ç»“ä¸€ä¸‹" class="header-anchor">#</a> å°ç»“ä¸€ä¸‹</h3> <p>çœ‹äº†ä¸Šé¢çš„è¿™äº›ä¸œè¥¿ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰è„‘å­è´¼ä¹±ï¼Œä»€ä¹ˆ<code>react</code>ã€<code>redux</code>ã€<code>react-redux</code>ã€<code>react-router</code>ã€<code>react-router-dom</code>ã€<code>connected-react-router</code>ï¼Œè¿™äº›æ¦‚å¿µæ˜¯çœŸçš„å¤šï¼Œæˆ‘åˆšå¼€å§‹æ¥è§¦çš„æ—¶å€™ç›´æ¥çœ‹æ‡µé€¼ã€‚ã€‚æ‰€ä»¥ react çš„å¯ç»„åˆæ€§æ¯” vue é«˜å¾ˆå¤šï¼Œæ‰€ä»¥è¯´ vue çœŸçš„æ˜¯è‡ªåŠ¨æŒ¡ã€react æ˜¯æ‰‹åŠ¨æŒ¡ã€‚ä½†æ˜¯æˆ‘ä»¬åªéœ€è®°ä½ï¼Œå‰ç«¯çš„ä¸€åˆ‡æ¦‚å¿µï¼Œéƒ½æ˜¯çº¸è€è™è€Œå·²ã€‚é™ä¸‹å¿ƒæ¥æ‹ä¸€æ‹ï¼Œå¾ˆå¿«å°±ç†è§£äº†ã€‚å¥½äº†ï¼Œç°åœ¨æ¥çœ‹çœ‹è¿™ä¸ªå›¾ï¼š</p> <p><img src="https://i.loli.net/2020/05/30/MvhzTLqPCjSlgF4.png" alt="react.png"></p> <p>ç»“åˆä¸Šé¢ä»‹ç»çš„çŸ¥è¯†ç‚¹ï¼ŒæŠŠæ€è·¯æ‹é¡ºï¼Œå’±ä»¬å†ç»§ç»­ ğŸ’ª</p> <h3 id="dva"><a href="#dva" class="header-anchor">#</a> dva</h3> <p>é€šè¿‡ä¸Šé¢çš„è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥æ­å»ºä¸€ä¸ªå¾ˆæ£’çš„åŸºäº<code>react</code>å’Œ<code>redux</code>çš„å·¥ç¨‹ã€‚å¦‚æœå•çº¯ä½¿ç”¨<code>redux</code>ï¼Œå½“é¡¹ç›®è¶Šæ¥è¶Šå¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„<code>redux</code>çš„æ“ä½œä¹Ÿä¼šå˜å¾—ç¹æ‚ï¼Œä»£ç å’Œæ–‡ä»¶çš„ç»„ç»‡ä¼šå˜å¾—è‡ƒè‚¿,æˆ‘ä»¬å°±å¿…é¡»æŠŠ<code>action</code>ã€<code>reducer</code>ã€<code>createActions</code>ã€<code>actionType</code>ç­‰ç­‰æ–‡ä»¶æ”¾åœ¨ä¸åŒçš„ç›®å½•ä¸‹é¢ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„æ—¶å€™ï¼Œå°±è¦æ‰“å¼€æ–‡ä»¶ç›®å½•å»ç¿»åŠå¤©ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿™äº›æ–‡ä»¶é‡Œé¢ä¸åœåˆ‡æ¢ï¼Œç®€ç›´æŠ“ç‹‚ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸ç¦ä¼šæƒ³ï¼šè¦æ˜¯æ‰€æœ‰çš„æ“ä½œéƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶è¯¥å¤šå¥½ï¼æ²¡é”™ï¼Œå®ƒæ¥äº†ã€‚å®ƒå°±æ˜¯<code>dva</code>ã€‚</p> <blockquote><p>dva é¦–å…ˆæ˜¯ä¸€ä¸ªåŸºäº redux å’Œ redux-saga çš„æ•°æ®æµæ–¹æ¡ˆï¼Œç„¶åä¸ºäº†ç®€åŒ–å¼€å‘ä½“éªŒï¼Œdva è¿˜é¢å¤–å†…ç½®äº† react-router å’Œ fetchï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½»é‡çº§çš„åº”ç”¨æ¡†æ¶ã€‚</p></blockquote> <p>å› ä¸ºæˆ‘ä»¬å‰é¢å·²ç»è‡ªå·±ç»„ç»‡äº†<code>react-router</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬åªä½¿ç”¨<code>dva-core</code>,æœ‰äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥å°† <code>reducers</code>, <code>effects</code> ç­‰ç­‰ç»„ç»‡åœ¨ä¸€ä¸ª<code>model</code>æ–‡ä»¶é‡Œé¢äº†ã€‚ä»¥å‰æˆ‘ä»¬ç»„ç»‡ä»£ç çš„æ–¹å¼æ˜¯<code>createAction.ts</code>ã€<code>actionType.ts</code>ã€<code>reducer/xxx.ts</code>,ä½†æ˜¯é€šè¿‡<code>dva</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™äº›éƒ½å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é…ç½®<code>dva-core</code>:</p> <p>é¦–å…ˆæˆ‘ä»¬éœ€è¦é€šè¿‡<code>dva create</code>æš´éœ²ä¸€ä¸ª<code>dva app</code>:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// dva/index.tsx</span>

<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> create <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dva-core'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  options<span class="token punctuation">.</span>models<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> app<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span>
  app<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> app<span class="token punctuation">.</span>_store
  app<span class="token punctuation">.</span><span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">container<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>container<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
  app<span class="token punctuation">.</span><span class="token function-variable function">getStore</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store

  <span class="token keyword">return</span> app
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šé¢çš„ <code>options</code> å³æ˜¯æˆ‘ä»¬çš„ <code>model</code> æ–‡ä»¶ã€‚ç„¶åæˆ‘ä»¬éœ€è¦åˆ©ç”¨è¿™ä¸ª <code>app</code> é‡æ–°é…ç½®æˆ‘ä»¬çš„ <code>store</code>:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">/// store/index.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connectRouter<span class="token punctuation">,</span> routerMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'connected-react-router'</span>
<span class="token keyword">import</span> dva <span class="token keyword">from</span> <span class="token string">'./dva'</span>
<span class="token keyword">import</span> models <span class="token keyword">from</span> <span class="token string">'../models'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">geneGrateSotore</span><span class="token punctuation">(</span>history<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> routerReducer <span class="token operator">=</span> <span class="token function">connectRouter</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
  <span class="token keyword">const</span> routerMiddlewareForDispatch <span class="token operator">=</span> <span class="token function">routerMiddleware</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">dva</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    models<span class="token punctuation">,</span>
    initState<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    extraReducers<span class="token operator">:</span> <span class="token punctuation">{</span> router<span class="token operator">:</span> routerReducer <span class="token punctuation">}</span><span class="token punctuation">,</span>
    onAction<span class="token operator">:</span> <span class="token punctuation">[</span>routerMiddlewareForDispatch<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> app
<span class="token punctuation">}</span>
</code></pre></div><p>ç„¶åä¸€æ ·çš„ï¼Œæˆ‘ä»¬åœ¨<code>App.tsx</code>ä½¿ç”¨å®ƒå³å¯:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConnectedRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'connected-react-router'</span>
<span class="token keyword">import</span> geneGrateSotore <span class="token keyword">from</span> <span class="token string">'./store'</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'./router'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">const</span> createHistory <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'history'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBrowserHistory
<span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">createHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">geneGrateSotore</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
<span class="token keyword">const</span> f<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span> <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ConnectedRouter</span></span> <span class="token attr-name">history</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Router</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ConnectedRouter</span></span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> f
</code></pre></div><p>è¿™å’Œä¹‹å‰é…ç½® <code>redux</code> å¯¹æ¯”èµ·æ¥ï¼Œæˆ‘ä»¬å·²ç»çœäº†å¾ˆå¤šçš„æ–‡ä»¶äº†ï¼Œæˆ‘ä»¬çš„ <code>store</code> æ–‡ä»¶æ¸…å‡€å¤šäº†ã€‚ä¸‹é¢æˆ‘ä»¬è¦æ¥ç¼–å†™<code>model</code>æ–‡ä»¶äº†ã€‚ä¾‹å¦‚æœ‰ä¸ªæ¨¡å—å«<code>model1</code>:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// model/model1.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token keyword">namespace</span> <span class="token operator">=</span> <span class="token string">'model1'</span>
<span class="token keyword">interface</span> <span class="token class-name">IDvaState</span> <span class="token punctuation">{</span>
  info1<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> state<span class="token operator">:</span> IDvaState <span class="token operator">=</span> <span class="token punctuation">{</span>
  info1<span class="token operator">:</span> <span class="token string">'init info1'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> model1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">namespace</span><span class="token punctuation">,</span>
  state<span class="token punctuation">,</span>
  effects<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span><span class="token function">changeInfo1</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> put <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> text <span class="token punctuation">}</span> <span class="token operator">=</span> payload
        <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'setState'</span><span class="token punctuation">,</span>
          payload<span class="token operator">:</span> <span class="token punctuation">{</span> info1<span class="token operator">:</span> text <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// eslint-disable-next-line no-empty</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span>state<span class="token operator">:</span> IDvaState<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token operator">...</span>payload <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>model1<span class="token punctuation">]</span>
</code></pre></div><p>è¿™ä¸ªæ–‡ä»¶å¯èƒ½æœ‰çš„å°ä¼™ä¼´ä¸€ä¸‹å­çœ‹ä¸æ˜ç™½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¸€èµ·æ‹ä¸€æ‹ã€‚</p> <ul><li><code>namespace</code>: å‘½åç©ºé—´(æˆ‘ä»¬ç»„ä»¶å¯ä»¥é€šè¿‡è¿™ä¸ª <code>namespace</code> æ‹¿åˆ°æˆ‘ä»¬çš„ <code>model</code>,ä»è€Œå–å€¼å’Œè¿›è¡Œæ“ä½œ)</li> <li><code>state</code>:è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬éœ€è¦ç®¡ç†çš„çŠ¶æ€(å­˜æ”¾çŠ¶æ€çš„åœ°æ–¹)</li> <li><code>effects</code>ï¼šä¸€äº›æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåŒæ­¥æ“ä½œå’Œå¼‚æ­¥æ“ä½œéƒ½æ”¾åˆ°<code>effects</code>é‡Œé¢,ç®€å•æ¥è¯´å°±æ˜¯æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘ã€‚è¿™é‡Œä¼šè¯¦ç»†ä»‹ç»ï¼Œå’±ä»¬å…ˆæ˜ç™½å®ƒæ˜¯åšä»€ä¹ˆçš„</li> <li><code>reducers</code>: <code>reducer</code>è¿™ä¸ªæ¦‚å¿µå°±æ˜¯è·Ÿ<code>redux</code>çš„<code>reducer</code>æ˜¯åŒä¸€ä¸ªæ„æ€(è¿”å›ä¸€ä¸ª<code>newState</code>ï¼Œæ›´æ–°<code>state</code>)
å¥½äº†æœ‰äº†ä¸Šé¢è¿™äº›æ¦‚å¿µï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æŠŠç»„ä»¶å’Œ<code>model</code>è”ç³»èµ·æ¥ã€‚</li></ul> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// home.tsx</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">namespace</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../models/model1'</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  info1<span class="token operator">:</span> <span class="token builtin">string</span>
  dispatch<span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Home</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token function-variable function">changeFormHome</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> dispatch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>namespace<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/changeInfo1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      payload<span class="token operator">:</span> <span class="token punctuation">{</span>
        text<span class="token operator">:</span> <span class="token string">'ä»Homeæ”¹å˜çš„info1'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info1<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">æˆ‘æ˜¯homeé¡µ</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info1<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeFormHome<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> homeç‚¹å‡»æ›´æ”¹redux</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">model<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  info1<span class="token operator">:</span> model<span class="token punctuation">[</span><span class="token keyword">namespace</span><span class="token punctuation">]</span><span class="token punctuation">.</span>info1<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span>
</code></pre></div><p>çœ‹äº†ä¸Šé¢çš„ä»£ç ï¼Œä½ æ˜¯ä¸æ˜¯ç¬é—´ç†è§£äº†ï¼Œå’±ä»¬è¿˜æ˜¯é€šè¿‡<code>react-redux</code>çš„<code>connect</code>æ¥è·å–<code>model</code>çš„ï¼Œåªä¸è¿‡æˆ‘ä»¬é€šè¿‡<code>namespace</code>æŒ‡å®šäº†å…·ä½“æ˜¯å“ªä¸ª<code>model</code>ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå’±ä»¬å·²ç»çŸ¥é“ï¼Œç»„ä»¶å¦‚ä½•ä»<code>model</code>é‡Œé¢å–å€¼ã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨ç»„ä»¶é‡Œé¢å¦‚ä½•æ”¹å˜ <code>model</code>é‡Œé¢çš„ <code>state</code> å‘¢ï¼Ÿ</p> <p>ç°åœ¨æˆ‘ä»¬çš„<code>home.tsx</code>é¡µé¢ä¸Šæœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®ä¼š<code>dispatch</code>ä¸€ä¸ª<code>action</code>:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">...</span>
 <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>namespace<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/changeInfo1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      payload<span class="token operator">:</span> <span class="token punctuation">{</span>
        text<span class="token operator">:</span> <span class="token string">'ä»Homeæ”¹å˜çš„info1'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª action çš„ type ä¸ºæˆ‘ä»¬çš„<code>model/effects/changeInfo1</code>ã€‚çœ‹åˆ°è¿™é‡Œç›¸ä¿¡ä½ å·²ç»ç†è§£å¾—å·®ä¸å¤šäº†ï¼Œå¯¹çš„ï¼Œå°±æ˜¯é€šè¿‡ <code>dispatch</code> ä¸€ä¸ªå’Œ <code>effects</code> é‡Œé¢çš„ä¸€ä¸ªåŒåæ–¹æ³•ï¼Œå³å¯æ‰¾åˆ° <code>effects</code> å¯¹åº”çš„æ–¹æ³•ã€‚<br>
æ¥ä¸‹æ¥åˆ°<code>effect</code>å¯¹åº”çš„<code>changeInfo1</code>çœ‹çœ‹æ˜¯å¦‚ä½•æ”¹å˜ stateã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">...</span>
 <span class="token operator">*</span><span class="token function">changeInfo1</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> put <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> text <span class="token punctuation">}</span> <span class="token operator">=</span> payload
        <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'setState'</span><span class="token punctuation">,</span>
          payload<span class="token operator">:</span> <span class="token punctuation">{</span> info1<span class="token operator">:</span> text <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// eslint-disable-next-line no-empty</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token operator">...</span>

</code></pre></div><p>æˆ‘ä»¬é€šè¿‡ <code>put</code> ,å‘èµ·äº†ä¸€ä¸ª<code>action</code>,åˆ°æœ€ç»ˆçš„<code>reducer</code>ï¼Œå…¶ä¸­çš„<code>payload</code>æ¥è‡ªæˆ‘ä»¬ä¼ å…¥çš„<code>text</code>ï¼Œç„¶å<code>state</code>è¢«ä¿®æ”¹äº†ï¼ŒåŒæ—¶é¡µé¢ä¹Ÿåˆ·æ–°äº†:</p> <p><img src="https://i.loli.net/2020/06/04/m1JxqcrCbWSNTBu.gif" alt="model.gif"></p> <p>é™¤äº†<code>put</code>,è¿˜æœ‰<code>call</code>(ç”¨äºå‘èµ·å¼‚æ­¥è¯·æ±‚)ã€<code>select</code>(ç”¨äºå–å‡º <code>state</code> é‡Œé¢çš„å€¼)ï¼Œéƒ½æ˜¯<code>redux-saga</code>æä¾›çš„ï¼Œè¿™é‡Œä¸è¿‡å¤šå™è¿°ï¼Œå…·ä½“ä½¿ç”¨çš„æ–¹æ³•è¯·æŸ¥é˜…<a href="https://redux-saga-in-chinese.js.org/" target="_blank" rel="noopener noreferrer">redux-saga<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ–‡æ¡£ã€‚</p> <p>æˆ‘è¿™é‡Œæ•´ç†äº†ä¸¤ä¸ªå›¾ï¼Œå¯¹æ¯”<code>redux</code>å’Œ<code>dva</code>çš„æµç¨‹æ“ä½œï¼š</p> <p><img src="https://i.loli.net/2020/06/05/uNZ15WxQFyTDUEf.png" alt="redux.png"></p> <p><img src="https://i.loli.net/2020/06/05/ea5dk7nSy3XrM4w.png" alt="dva.png"></p> <p>ç®€å•æ€»ç»“ä¸€ä¸‹ï¼š<code>dva</code> æŠŠ <code>action -&gt; reducer</code> æ‹†åˆ†æˆäº†ï¼Œ<code>action -&gt; model(reducer, effect)</code>æˆ‘ä»¬åœ¨å†™ä¸šåŠ¡çš„æ—¶å€™ï¼Œå†ä¹Ÿä¸ç”¨åˆ°å¤„å»æ‰¾æˆ‘ä»¬çš„<code>reducer</code>ã€<code>action</code>äº†ã€‚<code>dva</code>çœŸçš„ç»™æˆ‘ä»¬æä¾›äº†æå¤§çš„ä¾¿åˆ©ã€‚</p> <h2 id="ç”Ÿå‘½å‘¨æœŸ-æ–°æ—§å¯¹æ¯”"><a href="#ç”Ÿå‘½å‘¨æœŸ-æ–°æ—§å¯¹æ¯”" class="header-anchor">#</a> ç”Ÿå‘½å‘¨æœŸ(æ–°æ—§å¯¹æ¯”)</h2> <h3 id="æ—§ç‰ˆç”Ÿå‘½å‘¨æœŸ"><a href="#æ—§ç‰ˆç”Ÿå‘½å‘¨æœŸ" class="header-anchor">#</a> æ—§ç‰ˆç”Ÿå‘½å‘¨æœŸ</h3> <p>æ—§ç‰ˆç”Ÿå‘½å‘¨æœŸ æŒ‡çš„æ˜¯ React 16.3 åŠå…¶ä¹‹å‰çš„ç‰ˆæœ¬ã€‚</p> <p><img src="https://i.loli.net/2020/05/13/qxlU1hO2zeYKBiJ.png" alt="image"></p> <p>è¯·çœ‹ä¸‹é¢ä¸¤æ®µä»£ç </p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// çˆ¶ç»„ä»¶</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
      info<span class="token operator">:</span><span class="token string">'parent info'</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//åˆå§‹åŒ–é»˜è®¤çš„çŠ¶æ€å¯¹è±¡</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span><span class="token string">'parent life'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1. constructor åˆå§‹åŒ– props å’Œ state'</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
  <span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2. componentWillMount ç»„ä»¶å°†è¦æŒ‚è½½'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//ä¸€èˆ¬åœ¨componentDidMountæ‰§è¡Œå‰¯ä½œç”¨ï¼Œå¦‚å¼‚æ­¥è¯·æ±‚</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4. componentDidMount ç»„ä»¶æŒ‚è½½å®Œæˆ'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//å¼‚æ­¥è¯·æ±‚</span>
  <span class="token punctuation">}</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span>nextState</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5. shouldComponentUpdate è¯¢é—®ç»„ä»¶æ˜¯å¦éœ€è¦æ›´æ–°, è¿”å›trueåˆ™æ›´æ–°ï¼Œå¦åˆ™ä¸æ›´æ–°'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentWillUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'6. componentWillUpdate ç»„ä»¶å°†è¦æ›´æ–°'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'7. componentDidUpdate ç»„ä»¶æ›´æ–°å®Œæ¯•'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">changeName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3.renderæ¸²æŸ“'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> info <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
      <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token plain-text">:</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeName<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">æ›´æ”¹name</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token attr-name">parentName</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    )
  }
}
export default Parent

// å­ç»„ä»¶
import React, </span><span class="token punctuation">{</span> Component <span class="token punctuation">}</span><span class="token plain-text"> from 'react'
class Son extends Component </span><span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      info<span class="token operator">:</span> <span class="token string">'son info'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Son componentWillUnmount ç»„ä»¶å°†è¦æŒ‚è½½'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//è°ƒç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ä¼šæŠŠæ–°çš„å±æ€§å¯¹è±¡å’Œæ–°çš„çŠ¶æ€å¯¹è±¡ä¼ è¿‡æ¥</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>parentName <span class="token operator">!==</span> <span class="token string">'parent info'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//componentWillReceiveProp ç»„ä»¶æ”¶åˆ°æ–°çš„å±æ€§å¯¹è±¡</span>
  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1.Sonç»„ä»¶ componentWillReceiveProps'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 2.Sonç»„ä»¶ render'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>parentName<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token plain-text">
export default Son
</span></code></pre></div><blockquote><p>react çˆ¶å­ç»„ä»¶çš„æ¸²æŸ“é¡ºåºéµå¾ª<code>æ´‹è‘±æ¨¡å‹</code></p></blockquote> <h3 id="æ–°ç‰ˆç”Ÿå‘½å‘¨æœŸ"><a href="#æ–°ç‰ˆç”Ÿå‘½å‘¨æœŸ" class="header-anchor">#</a> æ–°ç‰ˆç”Ÿå‘½å‘¨æœŸ</h3> <p><img src="https://i.loli.net/2020/05/28/J9iDekbThNFI1Gc.png" alt="react-16.4.png"></p> <h3 id="static-getderivedstatefromprops"><a href="#static-getderivedstatefromprops" class="header-anchor">#</a> static getDerivedStateFromProps</h3> <ul><li><code>static getDerivedStateFromProps(nextProps,prevState)</code>ï¼šæ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ <code>props</code> å’Œç»„ä»¶ä¹‹å‰çš„çŠ¶æ€ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–° <code>state</code> æˆ–è€…è¿”å› <code>null</code> æ¥è¡¨ç¤ºæ¥æ”¶åˆ°çš„ <code>props</code> æ²¡æœ‰å˜åŒ–ï¼Œä¸éœ€è¦æ›´æ–° state.</li> <li>è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­çš„ä½œç”¨ï¼š å°†çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ props æ˜ å°„ åˆ°å­ç»„ä»¶çš„ <code>state</code> ä¸Šé¢ï¼Œè¿™æ ·ç»„ä»¶å†…éƒ¨å°±ä¸ç”¨å†é€šè¿‡ <code>this.props.xxx</code> è·å–å±æ€§å€¼äº†ï¼Œç»Ÿä¸€é€šè¿‡ <code>this.state.xxx</code> è·å–ã€‚æ˜ å°„å°±ç›¸å½“äºæ‹·è´äº†ä¸€ä»½çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„ <code>props</code> ï¼Œä½œä¸ºå­ç»„ä»¶è‡ªå·±çš„çŠ¶æ€ã€‚æ³¨æ„ï¼šå­ç»„ä»¶é€šè¿‡ <code>setState</code> æ›´æ–°è‡ªèº«çŠ¶æ€æ—¶ï¼Œä¸ä¼šæ”¹å˜çˆ¶ç»„ä»¶çš„ <code>props</code></li> <li>é…åˆ <code>componentDidUpdate</code>ï¼Œå¯ä»¥è¦†ç›– <code>componentWillReceiveProps</code> çš„æ‰€æœ‰ç”¨æ³•</li> <li>è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­è§¦å‘çš„æ—¶æœºï¼š</li></ul> <ol><li>åœ¨ React 16.3.0 ç‰ˆæœ¬ä¸­ï¼šåœ¨ç»„ä»¶å®ä¾‹åŒ–ã€æ¥æ”¶åˆ°æ–°çš„ <code>props</code> æ—¶ä¼šè¢«è°ƒç”¨</li> <li>åœ¨ React 16.4.0 ç‰ˆæœ¬ä¸­ï¼šåœ¨ç»„ä»¶å®ä¾‹åŒ–ã€æ¥æ”¶åˆ°æ–°çš„ <code>props</code> ã€ç»„ä»¶çŠ¶æ€æ›´æ–°æ—¶ä¼šè¢«è°ƒç”¨</li></ol> <div class="language-tsx extra-class"><pre class="language-tsx"><code>	<span class="token comment">// æ ¹æ®æ–°çš„å±æ€§å¯¹è±¡æ´¾ç”ŸçŠ¶æ€å¯¹è±¡</span>
  <span class="token comment">// nextProps:æ–°çš„å±æ€§å¯¹è±¡ prevState:æ—§çš„çŠ¶æ€å¯¹è±¡</span>
  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">nextprops<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'props'</span><span class="token punctuation">,</span>nextprops<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–° state æˆ–è€…è¿”å› null æ¥è¡¨ç¤ºæ¥æ”¶åˆ°çš„ props ä¸éœ€è¦æ›´æ–° state</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>parentName <span class="token operator">!==</span> <span class="token string">'parent info'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        info<span class="token operator">:</span> nextprops<span class="token punctuation">.</span>parentName<span class="token punctuation">,</span>
        <span class="token comment">// æ³¨æ„ï¼šè¿™é‡Œä¸éœ€è¦æŠŠç»„ä»¶è‡ªèº«çš„çŠ¶æ€ä¹Ÿæ”¾è¿›æ¥</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="getsnapshotbeforeupdate"><a href="#getsnapshotbeforeupdate" class="header-anchor">#</a> getSnapshotBeforeUpdate</h3> <ul><li><code>getSnapshotBeforeUpdate(prevProps</code>, <code>prevState</code>)ï¼šæ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ <code>props</code> å’Œç»„ä»¶ä¹‹å‰çš„çŠ¶æ€ï¼Œæ­¤ç”Ÿå‘½å‘¨æœŸé’©å­å¿…é¡»æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼å°†ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™ <code>componentDidUpdate</code>ã€‚å¿…é¡»å’Œ <code>componentDidUpdate</code> ä¸€èµ·ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li> <li>è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­è§¦å‘çš„æ—¶æœº ï¼šè¢«è°ƒç”¨äº <code>render</code> ä¹‹åã€æ›´æ–° <code>DOM</code> å’Œ <code>refs</code> ä¹‹å‰</li> <li>è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­çš„ä½œç”¨ï¼š å®ƒèƒ½è®©ä½ åœ¨ç»„ä»¶æ›´æ–° <code>DOM</code> å’Œ <code>refs</code> ä¹‹å‰ï¼Œä» <code>DOM</code> ä¸­æ•è·ä¸€äº›ä¿¡æ¯ï¼ˆä¾‹å¦‚æ»šåŠ¨ä½ç½®ï¼‰</li> <li>é…åˆ <code>componentDidUpdate</code>, å¯ä»¥è¦†ç›– <code>componentWillUpdate</code> çš„æ‰€æœ‰ç”¨æ³•</li> <li>demoï¼šæ¯æ¬¡ç»„ä»¶æ›´æ–°æ—¶ï¼Œéƒ½å»è·å–ä¹‹å‰çš„æ»šåŠ¨ä½ç½®ï¼Œè®©ç»„ä»¶ä¿æŒåœ¨ä¹‹å‰çš„æ»šåŠ¨ä½ç½®</li></ul> <div class="language-tsx extra-class"><pre class="language-tsx"><code> <span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¿”å›æ›´æ–°å†…å®¹çš„é«˜åº¦</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> prevScrollHeight</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// åœ¨è¿™é‡Œæ‹¿åˆ°é«˜åº¦</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollTop <span class="token operator">+</span>
      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollHeight <span class="token operator">-</span> prevScrollHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="ç‰ˆæœ¬è¿ç§»"><a href="#ç‰ˆæœ¬è¿ç§»" class="header-anchor">#</a> ç‰ˆæœ¬è¿ç§»</h3> <ul><li><code>componentWillMount</code>ï¼Œ<code>componentWillReceiveProps</code>ï¼Œ<code>componentWillUpdate</code> è¿™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå› ä¸ºç»å¸¸ä¼šè¢«è¯¯è§£å’Œæ»¥ç”¨ï¼Œæ‰€ä»¥è¢«ç§°ä¸º ä¸å®‰å…¨ï¼ˆä¸æ˜¯æŒ‡å®‰å…¨æ€§ï¼Œè€Œæ˜¯è¡¨ç¤ºä½¿ç”¨è¿™äº›ç”Ÿå‘½å‘¨æœŸçš„ä»£ç ï¼Œæœ‰å¯èƒ½åœ¨æœªæ¥çš„ <code>React</code> ç‰ˆæœ¬ä¸­å­˜åœ¨ç¼ºé™·ï¼Œå¯èƒ½ä¼šå½±å“æœªæ¥çš„å¼‚æ­¥æ¸²æŸ“ï¼‰ çš„ç”Ÿå‘½å‘¨æœŸã€‚</li> <li>React 16.3 ç‰ˆæœ¬ï¼šä¸ºä¸å®‰å…¨çš„ç”Ÿå‘½å‘¨æœŸå¼•å…¥åˆ«å <code>UNSAFE_componentWillMount</code>ï¼Œ<code>UNSAFE_componentWillReceiveProps</code> å’Œ <code>UNSAFE_componentWillUpdate</code>ã€‚ï¼ˆæ—§çš„ç”Ÿå‘½å‘¨æœŸåç§°å’Œæ–°çš„åˆ«åéƒ½å¯ä»¥åœ¨æ­¤ç‰ˆæœ¬ä¸­ä½¿ç”¨ï¼‰</li> <li>React 16.3 ä¹‹åçš„ç‰ˆæœ¬ï¼šä¸º <code>componentWillMount</code>ï¼Œ<code>componentWillReceiveProps</code> å’Œ <code>componentWillUpdate</code> å¯ç”¨å¼ƒç”¨è­¦å‘Šã€‚ï¼ˆæ—§çš„ç”Ÿå‘½å‘¨æœŸåç§°å’Œæ–°çš„åˆ«åéƒ½å¯ä»¥åœ¨æ­¤ç‰ˆæœ¬ä¸­ä½¿ç”¨ï¼Œä½†æ—§åç§°ä¼šè®°å½• DEV æ¨¡å¼è­¦å‘Šï¼‰ã€‚</li></ul> <blockquote><p>æ­¤æ®µæ€»ç»“å‡æ¥è‡ª<a href="https://juejin.im/post/5df648836fb9a016526eba01" target="_blank" rel="noopener noreferrer">ä½ çœŸçš„äº†è§£ React ç”Ÿå‘½å‘¨æœŸå—<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="header-anchor">#</a> æ€§èƒ½ä¼˜åŒ–</h2> <p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œreact æ˜¯æ•°æ®é©±åŠ¨è§†å›¾çš„å˜åŒ–ï¼Œå³æ˜¯é€šè¿‡<code>reder</code>æ¥æ¸²æŸ“è§†å›¾ï¼Œå½“æ•°æ®(å³çŠ¶æ€)å˜åŒ–æ—¶ï¼Œæˆ‘ä»¬çš„é¡µé¢å°±åº”å½“é‡æ–°æ¸²æŸ“ã€‚ä½†æ˜¯åº”ç”¨å¤æ‚ä¹‹åå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼šä¸€ä¸ªçˆ¶ç»„ä»¶ A ä¸‹é¢åŒ…å«äº†å¤šä¸ªå­ç»„ä»¶ Bã€Cã€Dã€‚å‡å¦‚ Bã€C ç»„ä»¶ç”¨åˆ°äº†çˆ¶ç»„ä»¶ A çš„æŸä¸ªå±æ€§ï¼Œå­ç»„ä»¶ D å´æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªå±æ€§ï¼Œå½“çˆ¶ç»„ä»¶çš„è¿™ä¸ªå±æ€§æ”¹å˜çš„æ—¶å€™ï¼Œä»–ä¸‹é¢çš„å­ç»„ä»¶ Bã€C ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œä½†æ˜¯å­ç»„ä»¶ D æœ¬ä¸éœ€è¦é‡æ–°æ¸²æŸ“ï¼Œä½†æ˜¯ä»–æ²¡åŠæ³•ï¼Œä»–ä¹Ÿè¢«é‡æ–°æ¸²æŸ“äº†ã€‚è¿™å°±é€ æˆäº†æ€§èƒ½æµªè´¹äº†ã€‚è¯´è¿™ä¹ˆå¤šï¼Œä¸å¦‚æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// çˆ¶ç»„ä»¶</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">'./son1'</span>
<span class="token keyword">import</span> Son2 <span class="token keyword">from</span> <span class="token string">'./son2'</span>
<span class="token keyword">import</span> Son3 <span class="token keyword">from</span> <span class="token string">'./son3'</span>

<span class="token keyword">interface</span> <span class="token class-name">Istate</span> <span class="token punctuation">{</span>
  info1<span class="token operator">:</span> <span class="token builtin">string</span>
  info2<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span>Istate<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> Istate <span class="token operator">=</span> <span class="token punctuation">{</span>
    info1<span class="token operator">:</span> <span class="token string">'info1'</span><span class="token punctuation">,</span>
    info2<span class="token operator">:</span> <span class="token string">'info2'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">info1Change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info1<span class="token operator">:</span> <span class="token string">'info1è¢«æ”¹å˜äº†...'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">çˆ¶ç»„ä»¶</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>info1Change<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> ç‚¹å‡»æ›´æ”¹info1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token attr-name">info1</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info1<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son2</span></span> <span class="token attr-name">info2</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info2<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Parent

<span class="token comment">// å­ç»„ä»¶1</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  info1<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Son1</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'son1é‡æ–°æ¸²æŸ“äº†....'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">æˆ‘æ˜¯son1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info1<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son1

<span class="token comment">// å­ç»„ä»¶2</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  info2<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Son2</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'son2é‡æ–°æ¸²æŸ“äº†....'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">æˆ‘æ˜¯son2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info2<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son2
</code></pre></div><p>ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œçˆ¶ç»„ä»¶æä¾›äº†ä¸¤ä¸ªå€¼ï¼š<code>info1</code> å’Œ <code>info2</code>ï¼Œå…¶ä¸­ <code>Son1</code> ç»„ä»¶åªç”¨åˆ°äº† <code>info1</code>ï¼Œ<code>Son2</code> ç»„ä»¶åªç”¨åˆ°äº† <code>info2</code>ã€‚æˆ‘ä»¬åœ¨çˆ¶ç»„ä»¶ä¸­ï¼Œç‚¹å‡»äº†æŒ‰é’®æ”¹å˜äº† <code>info1</code> çš„å€¼ï¼Œçˆ¶ç»„ä»¶å¿…é¡»é‡æ–°æ¸²æŸ“ï¼Œå› ä¸ºå®ƒè‡ªèº«çŠ¶æ€æ”¹å˜äº†ï¼Œ<code>Son1</code> ä¹Ÿåº”è¯¥é‡æ–°æ¸²æŸ“ï¼Œå› ä¸ºå®ƒä¾èµ–äº <code>info1</code>ï¼Œè€Œ <code>Son2</code> æ˜¯å¦åº”è¯¥é‡æ–°æ¸²æŸ“å‘¢ï¼ŸæŒ‰é“ç†ï¼Œå®ƒä¸åº”è¯¥é‡æ–°æ¸²æŸ“ï¼Œå› ä¸º <code>info2</code> æ²¡æœ‰æ”¹å˜ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æ¯æ¬¡ç‚¹å‡»æŒ‰é’®æ”¹å˜ <code>info1</code> çš„æ—¶å€™ï¼Œ<code>Son1</code> å’Œ<code>Son2</code> éƒ½é‡æ–°æ¸²æŸ“äº†ï¼Œè¿™å°±æ˜æ˜¾å­˜åœ¨é—®é¢˜äº†ã€‚</p> <h3 id="shouldcomponentupdate"><a href="#shouldcomponentupdate" class="header-anchor">#</a> shouldComponentUpdate</h3> <p>åœ¨ä¸Šé¢ ğŸ‘† ç”Ÿå‘½å‘¨æœŸç« èŠ‚ï¼Œæˆ‘ä»¬è®²åˆ°äº†<code>shouldComponentUpdate</code>è¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ä¸‹ä¸€æ¬¡çš„ <code>props</code> å’Œä¸‹ä¸€æ¬¡çš„ <code>state</code>ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ‹¿åˆ°ä¸‹ä¸€æ¬¡çš„ <code>props</code>(<code>nextProps</code>)å’Œå½“å‰çš„ <code>props</code> è¿›è¡Œæ¯”è¾ƒï¼Œæ ¹æ®æˆ‘ä»¬çš„åœºæ™¯ï¼Œè¿”å›ä¸€ä¸ª <code>bool</code> å˜é‡ï¼Œè¿”å› <code>true</code>ï¼Œåˆ™è¡¨ç¤ºè¦æ›´æ–°å½“å‰ç»„ä»¶ï¼Œè¿”å› <code>false</code> åˆ™è¡¨ç¤ºä¸æ›´æ–°å½“å‰ç»„ä»¶ã€‚</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  info2<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Son2</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆ©ç”¨ç”Ÿå‘½å‘¨æœŸ shouldComponentUpdate è¿›è¡Œæ¯”è¾ƒ</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token operator">:</span> Iprops<span class="token punctuation">,</span> nextState<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>info2 <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info2<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'son2é‡æ–°æ¸²æŸ“äº†....'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">æˆ‘æ˜¯son2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info2<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son2
</code></pre></div><p>å½“æˆ‘ä»¬å†æ¬¡ç‚¹å‡»æŒ‰é’®æ›´æ”¹<code>info1</code>çš„å€¼ï¼Œå‘ç°<code>Son2</code>å°±ä¸ä¼šå†é‡æ–°æ¸²æŸ“äº†ã€‚</p> <h3 id="purecomponet"><a href="#purecomponet" class="header-anchor">#</a> PureComponet</h3> <p><code>react</code>ä¸ºæˆ‘ä»¬æä¾›äº†<code>PureComponet</code>çš„è¯­æ³•ç³–ï¼Œç”¨å®ƒä¹Ÿå¯ä»¥ç”¨ä½œç»„ä»¶æ˜¯å¦æ¸²æŸ“çš„æ¯”è¾ƒã€‚å®ƒçš„åŸç†å°±æ˜¯å†…éƒ¨å®ç°äº†<code>shouldComponentUpdate</code>ã€‚è®©æˆ‘ä»¬ç”¨<code>PureComponet</code>æ¥æ”¹é€ ä¸€ä¸‹åˆšåˆšçš„<code>Son2</code>ç»„ä»¶:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  info2<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Son2</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent<span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'son2é‡æ–°æ¸²æŸ“äº†....'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">æˆ‘æ˜¯son2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info2<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son2
</code></pre></div><p>å†æ¬¡ç‚¹å‡»æŒ‰é’®æ”¹å˜<code>info1</code>çš„å€¼ï¼Œå‘ç°<code>Son2</code>ä¹Ÿä¸ä¼šæ¸²æŸ“äº†ã€‚</p> <p>è™½ç„¶<code>PureComponent</code>å¸®æˆ‘ä»¬å¾ˆå¥½çš„å®ç°äº†<code>shouldComponentUpdate</code>ï¼Œä½†æ˜¯å®ƒä¹Ÿæ˜¯æœ‰ç¼ºç‚¹çš„ã€‚å®ƒåªèƒ½ç”¨ä½œå¯¹è±¡çš„æµ…å±‚æ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯å®ƒåªä¼šè¿›è¡Œä¸€å±‚æ¯”è¾ƒï¼Œå½“æˆ‘ä»¬çš„æ•°æ®æ˜¯åµŒå¥—çš„å¯¹è±¡æˆ–è€…æ•°ç»„çš„æ—¶å€™ï¼Œå®ƒå°±æ— æ³•æ¯”è¾ƒäº†ã€‚æ‰€ä»¥<code>PureComponent</code>æœ€å¥½åªç”¨äº<code>å±•ç¤ºå‹ç»„ä»¶</code>ã€‚</p> <p>é™¤äº†ä»¥ä¸Šç¼ºç‚¹ä»¥å¤–ï¼Œ<code>PureComponent</code>è¿˜æœ‰ä¸€äº›å¦å¤–å€¼å¾—æˆ‘ä»¬æ³¨æ„çš„åœ°æ–¹ï¼š</p> <p>å½“æˆ‘ä»¬ç»™<code>PureComponent</code>åŒ…è£¹çš„å­ç»„ä»¶ä¼ å…¥ä¸€ä¸ª<code>ç«‹å³æ‰§è¡Œå‡½æ•°</code>çš„æ—¶å€™ï¼Œçˆ¶ç»„ä»¶çš„çŠ¶æ€æ”¹å˜çš„æ—¶å€™ï¼Œè¿™ä¸ªå­ç»„ä»¶å§‹ç»ˆä¼šé‡æ–°æ¸²æŸ“ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son2</span></span> <span class="token attr-name">info2</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info2<span class="token punctuation">}</span></span> <span class="token attr-name">change</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>è¿™ä¸ªé—®é¢˜çš„å‡ºç°æ˜¯å› ä¸º <code>change</code> è¿™ä¸ªå‡½æ•°æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥å¯¼è‡´ <code>Son2</code> ç»„ä»¶æ¯æ¬¡éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p> <ul><li>ç¬¬ä¸€ç§ï¼Œå°†è¿™ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°ï¼ŒæŠ½å–åˆ°ç±»æ–¹æ³•ä¸Šï¼Œå¹¶ä¸”åœ¨<code>constructor</code> bind <code>this</code>:</li></ul> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>change <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  state<span class="token operator">:</span> Istate <span class="token operator">=</span> <span class="token punctuation">{</span>
    info1<span class="token operator">:</span> <span class="token string">'info1'</span><span class="token punctuation">,</span>
    info2<span class="token operator">:</span> <span class="token string">'info2'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">info1Change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info1<span class="token operator">:</span> <span class="token string">'info1è¢«æ”¹å˜äº†...'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">çˆ¶ç»„ä»¶</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>info1Change<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> ç‚¹å‡»æ›´æ”¹info1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token attr-name">info1</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info1<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son2</span></span> <span class="token attr-name">info2</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info2<span class="token punctuation">}</span></span> <span class="token attr-name">change</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>change<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</code></pre></div><ul><li>ç¬¬äºŒç§ï¼Œåˆ©ç”¨ç®­å¤´å‡½æ•°å°†ç«‹å³å‡½æ•°æŠ½å–æˆç±»å±æ€§ï¼š</li></ul> <div class="language-tsx extra-class"><pre class="language-tsx"><code>state<span class="token operator">:</span> Istate <span class="token operator">=</span> <span class="token punctuation">{</span>
    info1<span class="token operator">:</span> <span class="token string">'info1'</span><span class="token punctuation">,</span>
    info2<span class="token operator">:</span> <span class="token string">'info2'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">info1Change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info1<span class="token operator">:</span> <span class="token string">'info1è¢«æ”¹å˜äº†...'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">çˆ¶ç»„ä»¶</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>info1Change<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> ç‚¹å‡»æ›´æ”¹info1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token attr-name">info1</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info1<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son2</span></span> <span class="token attr-name">info2</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info2<span class="token punctuation">}</span></span> <span class="token attr-name">change</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>change<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="memo"><a href="#memo" class="header-anchor">#</a> Memo</h3> <p>åˆšåˆšæˆ‘ä»¬ä»‹ç»äº†<code>PureComponent</code>ï¼Œä½†æ˜¯è¿™åªæ˜¯ç”¨äº<code>class</code>ç»„ä»¶ï¼Œå½“æˆ‘ä»¬ç”¨å‡½æ•°ç»„ä»¶æ—¶ï¼Œ<code>react</code> ä¹Ÿç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§æ–¹å¼ï¼š<code>memo</code></p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  info2<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> Son3<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'son3é‡æ–°æ¸²æŸ“äº†....'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">æˆ‘æ˜¯Son3</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>info2<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">memo</span><span class="token punctuation">(</span>Son3<span class="token punctuation">)</span>
</code></pre></div><p>ä¸è¿‡ä½¿ç”¨ memo çš„æ—¶å€™ä¹Ÿæœ‰<code>PureComponent</code>çš„é™åˆ¶ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦æ³¨æ„ã€‚</p> <p>çœ‹åˆ°äº†è¿™é‡Œï¼Œè‚¯å®šå¾ˆå¤šåŒå­¦éƒ½åœ¨é—®ï¼Œhooks å“ªå»äº†ï¼Ÿåˆ«æ€¥å‘¢ï¼Œé©¬ä¸Šå°±æ¥ ğŸ‘‡</p> <h2 id="hooks"><a href="#hooks" class="header-anchor">#</a> hooks</h2> <p>éšç€<code>react 16.8</code>ç‰ˆæœ¬çš„å‡ºç°ï¼Œ<code>hooks</code>ä¹Ÿé—®ä¸–äº†ã€‚<code>hooks</code>è§£å†³äº†<code>class</code>ç»„ä»¶é¥±å—è¯Ÿç—…çš„ä¼—å¤šé—®é¢˜ï¼Œæ¯”å¦‚ç»‘å®š<code>this</code>çš„é—®é¢˜ã€ç»„ä»¶çš„é€»è¾‘å¤ç”¨çš„é—®é¢˜ç­‰ç­‰ã€‚å…¶å®èµ·åˆæˆ‘å¯¹<code>hooks</code>å¹¶ä¸ååˆ†æ„Ÿå†’ï¼Œå› ä¸ºé‚£ä¸ªæ—¶å€™ç¬”è€…è¿<code>class</code>å†™æ³•éƒ½è¿˜æ²¡æŒæ¡ï¼Œå†å­¦ä¸ªè¿™ç©æ„ç®€ç›´å¾’å¢çƒ¦æ¼ã€‚åæ¥æ²¡åŠæ³•ï¼Œå›¢é˜Ÿé‡Œçš„å°ä¼™ä¼´éƒ½å¼€å§‹ä½¿ç”¨<code>hooks</code>ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿè¢«åŠ¨å­¦ä¹ äº†ä¸€æ³¢ã€‚è¿™ä¸å†™ä¸çŸ¥é“ï¼Œä¸€å†™å°±çœŸé¦™ï¼ï¼ï¼æ‰€ä»¥èµ¶ç´§å­¦èµ·æ¥å§</p> <h3 id="usestate"><a href="#usestate" class="header-anchor">#</a> useState</h3> <p>è®°ä½ä¸€ä¸ªç‚¹ï¼Œ<code>useState</code>è¿”å›ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯<code>state</code>(ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„<code>state</code>)ã€ä¸€ä¸ªæ˜¯ç”¨äºæ›´æ–°<code>state</code>çš„å‡½æ•°ã€‚å…¶å®ä½ å«å•¥åéƒ½è¡Œï¼Œä¸è¿‡å’±ä»¬ä¸ºäº†ç»™ hooks ä¸€ä¸ªæ ‡å¿—ï¼Œå¤§å¤šé‡‡ç”¨å¦‚ä¸‹å†™æ³•ï¼š</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initState<span class="token punctuation">)</span>
</code></pre></div><p>å¥½äº†ï¼ŒæŒæ¡è¿™ä¸ªå°±è¡Œäº†ï¼Œæˆ‘ä»¬æ¥ä½¿ç”¨ä¸€ä¸‹ï¼š(åˆ«å¿˜è®°äº†ï¼Œæˆ‘ä»¬ç°åœ¨åªéœ€è¦å†™å‡½æ•°å¼ç»„ä»¶äº†å“¦)</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> goodsList <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>info<span class="token punctuation">,</span> setInfo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'init info'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setinfo</span><span class="token punctuation">(</span><span class="token string">'æ”¹å˜info'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> ç‚¹å‡»æ›´æ”¹info</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Home
</code></pre></div><p>å½“æˆ‘ä»¬åˆæ¬¡è¿›å…¥ <code>home</code> é¡µé¢æ—¶ï¼Œé¡µé¢ä¸Šä¼šæ˜¾ç¤º <code>info</code> çš„åˆå§‹å€¼ï¼š<code>init info</code>ï¼Œç„¶åå½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œè°ƒç”¨ <code>setInfo</code>,ç„¶å <code>info</code> çš„å€¼å°±è¢«æ”¹å˜äº†ã€‚å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚</p> <h3 id="useeffect"><a href="#useeffect" class="header-anchor">#</a> useEffect</h3> <p><code>useEffect</code> å…¶å®åªæ¯”å¤æ‚äº†é‚£ä¹ˆä¸€ç‚¹ã€‚å®ƒåˆæˆäº† <code>calss</code> ç»„ä»¶ä¸­çš„<code>componentDidMount</code>ã€<code>componentDidUpdate</code>ã€ <code>componentWillUnmount</code>ã€‚ æˆ‘ä»¬å¾ˆå®¹æ˜“å°±æ˜ç™½ï¼Œå®ƒæ˜¯ç”¨æ¥æ‰§è¡Œå‰¯ä½œç”¨çš„ï¼Œæœ€æœ€å¸¸è§çš„å‰¯ä½œç”¨å°±æ˜¯å¼‚æ­¥è¯·æ±‚ã€‚</p> <p>ä¸‹é¢æˆ‘ä»¬ç”¨å®ƒæ¥å®ç°<code>class</code>ç»„ä»¶çš„<code>componentDidMount</code>çš„ç”¨æ³•:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> goodsList <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// è·å–å•†å“åˆ—è¡¨</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>namespace<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/getGoodsList</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è°ƒç”¨æ–¹æ³•å‘èµ·å¼‚æ­¥è¯·æ±‚</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token operator">:</span> <span class="token string">'5px'</span><span class="token punctuation">,</span> marginLeft<span class="token operator">:</span> <span class="token string">'400px'</span><span class="token punctuation">,</span> marginRight<span class="token operator">:</span> <span class="token string">'400px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> display<span class="token operator">:</span> <span class="token string">'flex'</span><span class="token punctuation">,</span> flexDirection<span class="token operator">:</span> <span class="token string">'row'</span><span class="token punctuation">,</span> justifyContent<span class="token operator">:</span> <span class="token string">'space-around'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>goodsList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Card</span></span> <span class="token attr-name">hoverable</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">240</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token attr-name">cover</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>example<span class="token punctuation">'</span></span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Card</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">model</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  goodsList<span class="token operator">:</span> model<span class="token punctuation">[</span><span class="token keyword">namespace</span><span class="token punctuation">]</span><span class="token punctuation">.</span>goodsList<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span>
</code></pre></div><p>ä¸Šé¢çš„<code>getList</code>å°±æ˜¯å’±ä»¬å‘èµ·å¼‚æ­¥è¯·æ±‚çš„æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨<code>useEffect</code>é‡Œé¢ä½¿ç”¨äº†å®ƒï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜ä¼ å…¥äº†ä¸€ä¸ª<code>[]</code>,å°±è¡¨ç¤ºæˆ‘ä»¬åªéœ€åœ¨é¡µé¢åˆå§‹åŒ–çš„æ—¶å€™å‘èµ·è¯·æ±‚ï¼Œè¿™æ ·ä½¿ç”¨å°±ç›¸å½“äº<code>class</code>ç»„ä»¶çš„<code>componentDidMount</code>ã€‚</p> <p>æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥å®ç°<code>class</code>ç»„ä»¶çš„<code>componentDidUpdate</code>çš„ç”¨æ³•:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Card <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">namespace</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../models/model1'</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  goodsList<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  dispatch<span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> goodsList <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>info<span class="token punctuation">,</span> setInfo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'init info'</span><span class="token punctuation">)</span>

  <span class="token comment">// è·å–å•†å“åˆ—è¡¨</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>namespace<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/getGoodsList</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>info<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token operator">:</span> <span class="token string">'5px'</span><span class="token punctuation">,</span> marginLeft<span class="token operator">:</span> <span class="token string">'400px'</span><span class="token punctuation">,</span> marginRight<span class="token operator">:</span> <span class="token string">'400px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">æˆ‘æ˜¯homeé¡µ</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setInfo</span><span class="token punctuation">(</span><span class="token string">'æ”¹å˜info'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> ç‚¹å‡»æ›´æ”¹info</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> display<span class="token operator">:</span> <span class="token string">'flex'</span><span class="token punctuation">,</span> flexDirection<span class="token operator">:</span> <span class="token string">'row'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>goodsList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Card</span></span> <span class="token attr-name">hoverable</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">240</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token attr-name">cover</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>example<span class="token punctuation">'</span></span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Card</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">model</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  goodsList<span class="token operator">:</span> model<span class="token punctuation">[</span><span class="token keyword">namespace</span><span class="token punctuation">]</span><span class="token punctuation">.</span>goodsList<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span>
</code></pre></div><p>çœ‹ä¸Šé¢ï¼Œæˆ‘ä»¬å¸Œæœ›ç‚¹å‡»æŒ‰é’®æ—¶æ”¹å˜ <code>info</code> æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å†å»å‘èµ·è¯·æ±‚ï¼Œä»è€Œåˆ·æ–°é¡µé¢(ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>goodsList</code> çš„æ•°æ®ä¾èµ–äº <code>info</code>)ã€‚å¯ä»¥çœ‹è§ï¼Œæˆ‘ä»¬è¿™é‡Œè¿˜æ˜¯åˆ©ç”¨äº†<code>useEffect</code>çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œåªä¸è¿‡è¿™æ¬¡æˆ‘ä»¬ä¼ å…¥çš„æ˜¯<code>[info]</code>ï¼Œæ„æ€å°±æ˜¯å‘Šè¯‰<code>useEffect</code>ï¼Œå¦‚æœ <code>info</code> çš„å€¼å‘ç”Ÿæ”¹å˜äº†ï¼Œå°±å»å‘èµ·è¯·æ±‚ã€‚è¿™ç›¸å½“äºæˆ‘ä»¬åœ¨<code>class</code>ç»„ä»¶çš„<code>componentDidMount</code>é’©å­ã€‚</p> <p>æ¥ä¸‹æ¥è¿˜æœ‰æœ€åä¸€ä¸ª<code>class</code>ç»„ä»¶çš„<code>componentWillUnmount</code>çš„ç”¨æ³•äº†ã€‚è¿™ä¸ªå°±æ›´ç®€å•äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨<code>useEffect</code> <code>return</code> ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå°±å¯ä»¥ç”¨æ¥æ¸…é™¤ä¸Šä¸€æ¬¡å‰¯ä½œç”¨ç•™ä¸‹çš„å‰¯ä½œç”¨äº†:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token operator">...</span><span class="token punctuation">.</span>
 <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>namespace<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/clearData</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">...</span><span class="token punctuation">.</span>

</code></pre></div><h3 id="useref"><a href="#useref" class="header-anchor">#</a> useRef</h3> <p>è¿™ä¸ª<code>hook</code>æ›´ç®€å•äº†ï¼Œå®ƒå°±æ˜¯ç”¨æ¥æ‹¿åˆ°å­ç»„ä»¶çš„å®ä¾‹çš„ï¼Œç›¸å½“äº<code>class</code>ç»„ä»¶çš„<code>React.createRef()</code>ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Card <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">namespace</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../models/model1'</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./components/son'</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  goodsList<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  dispatch<span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> goodsList <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sonRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// åœ¨è¿™é‡Œæ–°å»ºä¸€ä¸ªå­ç»„ä»¶çš„ref</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>info<span class="token punctuation">,</span> setInfo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'init info'</span><span class="token punctuation">)</span>

  <span class="token comment">// è·å–å•†å“åˆ—è¡¨</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    conson<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sonRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token comment">// åœ¨è¿™é‡Œå°±å¯ä»¥é€šè¿‡sonRefæ‹¿åˆ°å­ç»„ä»¶</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>namespace<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/getGoodsList</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>info<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">æˆ‘æ˜¯homeé¡µ</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setInfo</span><span class="token punctuation">(</span><span class="token string">'æ”¹å˜info'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> ç‚¹å‡»æ›´æ”¹info</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> display<span class="token operator">:</span> <span class="token string">'flex'</span><span class="token punctuation">,</span> flexDirection<span class="token operator">:</span> <span class="token string">'row'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>goodsList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Card</span></span> <span class="token attr-name">hoverable</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">240</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token attr-name">cover</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>example<span class="token punctuation">'</span></span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Card</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">model</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  goodsList<span class="token operator">:</span> model<span class="token punctuation">[</span><span class="token keyword">namespace</span><span class="token punctuation">]</span><span class="token punctuation">.</span>goodsList<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span>
</code></pre></div><h3 id="usecontext"><a href="#usecontext" class="header-anchor">#</a> useContext</h3> <p><code>useContext</code>è¿™ä¸ª<code>hook</code>çš„ä½œç”¨ä¹Ÿå¾ˆç®€å•ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨<code>Context</code>ï¼Œè€Œä¸”å®ƒè¿˜è§£å†³äº†ä»¥å‰æˆ‘ä»¬éœ€è¦åˆ©ç”¨<code>Consumer</code>åŒ…è£¹ç»„ä»¶çš„é—®é¢˜ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// context.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> Consumer <span class="token punctuation">}</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">//åˆ›å»º context å¹¶æš´éœ²Providerå’ŒConsumer</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> Consumer <span class="token punctuation">}</span>

<span class="token comment">// çˆ¶ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./son'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./context'</span>
<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">'info from father'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father
</code></pre></div><p>åœ¨ <code>class</code> ç»„ä»¶é‡Œé¢ï¼Œæˆ‘ä»¬è¦æƒ³æ‹¿åˆ° Context é‡Œé¢çš„å€¼ï¼Œå¿…é¡»é€šè¿‡ <code>Consumer</code> åŒ…è£¹ç»„ä»¶ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// å­ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Consumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./context'</span>
<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token comment">// é€šè¿‡Consumerç›´æ¥è·å–çˆ¶ç»„ä»¶çš„å€¼</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">çˆ¶ç»„ä»¶çš„å€¼:</span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Consumer</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son
</code></pre></div><p>æœ‰äº† <code>useContext</code>ï¼Œå°±åªéœ€è¦è¿™æ ·:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// å­ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
funcion <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>Context<span class="token punctuation">)</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">çˆ¶ç»„ä»¶çš„å€¼:</span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šé¢ç›´æ¥ä½¿ç”¨ <code>React.useContext(Context)</code> å°±å¯ä»¥è·å¾— <code>context</code>ï¼Œè€Œåœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­éœ€è¦åƒè¿™æ ·æ‰èƒ½è·å– <code>&lt;Consumer&gt;({vlaue} =&gt; {})&lt;/Consumer&gt;</code> ï¼Œè¿™æå¤§çš„ç®€åŒ–äº†ä»£ç çš„ä¹¦å†™ã€‚</p> <h3 id="usememo"><a href="#usememo" class="header-anchor">#</a> useMemo</h3> <p>å…ˆæ¥çœ‹çœ‹å®˜ç½‘ç»™å‡ºçš„ç”¨æ³•ï¼š</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> memoizedValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">computeExpensiveValue</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>æ ¹æ®å®˜ç½‘çš„è§£é‡Šå’Œè¿™ä¸ªç”¨æ³•å¯ä»¥çœ‹å‡ºï¼Œåœ¨ <code>a</code> å’Œ <code>b</code> çš„å˜é‡å€¼ä¸å˜çš„æƒ…å†µä¸‹ï¼Œ<code>memoizedValue</code>çš„å€¼ä¸å˜ã€‚å³æ˜¯ï¼š<code>useMemo</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå…¥å‚å‡½æ•°ä¸ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°èŠ‚çœè®¡ç®—é‡çš„ç›®çš„ï¼ˆæœ‰ç‚¹åƒ<code>vue</code>çš„è®¡ç®—å±æ€§ï¼‰ã€‚é‚£å®ƒæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿé€šå¸¸æ¥è¯´å¯ä»¥ç”¨ä½œæ€§èƒ½ä¼˜åŒ–çš„æ‰‹æ®µã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// çˆ¶ç»„ä»¶</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Input <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">'./son1'</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>info<span class="token punctuation">,</span> setInfo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> setVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">onVisible</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">visible</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>visible<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">changeInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token function">setInfo</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token operator">:</span> <span class="token string">'5px'</span><span class="token punctuation">,</span> marginLeft<span class="token operator">:</span> <span class="token string">'400px'</span><span class="token punctuation">,</span> marginRight<span class="token operator">:</span> <span class="token string">'400px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">changeInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Input</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token attr-name">onVisible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onVisible<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home

<span class="token comment">// å­ç»„ä»¶</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">onVisible</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> Son1<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onVisible <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æˆ‘è¢«é‡æ–°æ¸²æŸ“äº†....'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">onVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">button</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son1
</code></pre></div><p>åœ¨çˆ¶ç»„ä»¶ä¸­ï¼Œæœ‰ä¸ª<code>Input</code>è¾“å…¥æ¡†,æ¯æ¬¡è¾“å…¥æ–°çš„å€¼ï¼Œçˆ¶ç»„ä»¶çš„<code>info</code>çš„å€¼å°±ä¼šå‘ç”Ÿæ”¹å˜ï¼ŒåŒæ—¶æˆ‘ä»¬å‘ç°å­ç»„ä»¶æ¯æ¬¡éƒ½ä¼šé‡æ–°æ¸²æŸ“ï¼Œå³ä½¿æˆ‘ä»¬å­ç»„ä»¶æ²¡ç”¨åˆ°<code>info</code>çš„å€¼ï¼Œé‚£æ˜¯å› ä¸º<code>setInfo</code>å¯¼è‡´çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“äº†ï¼Œä¹Ÿå¯¼è‡´<code>onVisible</code>æ¯æ¬¡éƒ½å˜æˆä¸€ä¸ªæ–°çš„å€¼ï¼Œæ‰€ä»¥å¼•èµ·å­ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚é‚£ä¹ˆæœ‰çš„åŒå­¦å°±ä¼šè¯´ï¼Œå¯ä»¥åˆ©ç”¨<code>React.memo</code>ï¼Œæˆ‘ä»¬æ¥è¯•ä¸€è¯•:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">onVisible</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> Son1<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onVisible <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æˆ‘è¢«é‡æ–°æ¸²æŸ“äº†....'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">onVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">button</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">memo</span><span class="token punctuation">(</span>Son1<span class="token punctuation">)</span>
</code></pre></div><p>ç„¶åæˆ‘ä»¬éšä¾¿åœ¨è¾“å…¥æ¡†è¾“å…¥æ–°çš„å€¼ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå­ç»„ä»¶ä»ç„¶ä¼šé‡æ–°æ¸²æŸ“ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿé‚£æ˜¯å› ä¸ºè¿™é‡Œçš„<code>props.onVisible</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å€¼ï¼Œå½“çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“<code>onVisible</code> è¿™ä¸ªå‡½æ•°ä¹Ÿä¼šé‡æ–°ç”Ÿæˆ,è¿™æ ·å¼•ç”¨åœ°å€å˜åŒ–å°±å¯¼è‡´å¯¹æ¯”å‡ºæ–°çš„æ•°æ®,å­ç»„ä»¶å°±ä¼šé‡æ–°æ¸²æŸ“ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¼“å­˜<code>onVisible</code>è¿™ä¸ªå‡½æ•°ï¼Œå³æ˜¯ï¼šæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€éè¿™ä¸ªå‡½æ•°ï¼Œä»¥åçˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“çš„æ—¶å€™ï¼Œ<code>onVisible</code>çš„å€¼ä»ç„¶æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„å€¼ï¼Œè¿™æ ·å­ç»„ä»¶æ‰ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±ç”¨åˆ°äº†<code>useMemo</code>ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Input <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">'./son1'</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>info<span class="token punctuation">,</span> setInfo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> setVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> onVisible <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">visible</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>visible<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">changeInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token function">setInfo</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token operator">:</span> <span class="token string">'5px'</span><span class="token punctuation">,</span> marginLeft<span class="token operator">:</span> <span class="token string">'400px'</span><span class="token punctuation">,</span> marginRight<span class="token operator">:</span> <span class="token string">'400px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">changeInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Input</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token attr-name">onVisible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onVisible<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home
</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆ©ç”¨<code>useMemo</code>å°†<code>onVisible</code>ç¼“å­˜èµ·æ¥äº†,æˆ‘ä»¬åœ¨<code>useMemo</code>çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥äº†ä¸€ä¸ª<code>[]</code>ï¼Œè¡¨æ˜å®ƒåªä¼šåœ¨æ¸²æŸ“æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™é‡Œçš„ç”¨æ³•è·Ÿ<code>useEffect</code>ä¸€æ ·ï¼Œ<code>[]</code>ä¼ å…¥ä¾èµ–é¡¹ï¼Œå½“ä¾èµ–é¡¹æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬ç¼“å­˜çš„å€¼æ‰ä¼šé‡æ–°è®¡ç®—ã€‚å†æ¬¡åœ¨è¾“å…¥æ¡†è¾“å…¥æ–°çš„å€¼ï¼Œæˆ‘ä»¬å‘ç°å­ç»„ä»¶ä¸æ¸²æŸ“äº†ã€‚</p> <blockquote><p><code>useMemo</code> ä¸€èˆ¬ç”¨äºè®¡ç®—æ¯”è¾ƒå¤æ‚çš„åœºæ™¯</p></blockquote> <h3 id="usecallback"><a href="#usecallback" class="header-anchor">#</a> useCallback</h3> <p>å¦‚æœæŒæ¡äº†<code>useMemo</code>ï¼Œé‚£æŒæ¡ <code>useCallback</code>ç®€ç›´ä¸åœ¨è¯ä¸‹ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®šä¹‰:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> memoizedCallback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">doSomething</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>åœ¨ <code>a</code>å’Œ<code>b</code> çš„å˜é‡å€¼ä¸å˜çš„æƒ…å†µä¸‹ï¼Œ<code>memoizedCallback</code> çš„å¼•ç”¨ä¸å˜ã€‚å³ï¼š<code>useCallback</code> çš„ç¬¬ä¸€ä¸ªå…¥å‚å‡½æ•°ä¼šè¢«ç¼“å­˜ï¼Œä»è€Œè¾¾åˆ°æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–çš„ç›®çš„ã€‚æ˜¯ä¸æ˜¯è·Ÿ<code>useMemo</code>å¾ˆåƒï¼Ÿ<code>useMemo</code>æ˜¯ç¼“å­˜å€¼ï¼Œ<code>useCallback</code>ä¸€ä¸ªæ˜¯ç¼“å­˜å‡½æ•°çš„å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ <code>useCallback(fn, [deps])</code> ç›¸å½“äº <code>useMemo(() =&gt; fn, [deps])</code>ã€‚æˆ‘ä»¬ç°åœ¨ç”¨ <code>useCallback</code> æ¥æ”¹é€ ä¸€ä¸‹åˆšåˆšä¸Šé¢ ğŸ‘† é‚£ä¸ªä¾‹å­:</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code>
<span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>info<span class="token punctuation">,</span> setInfo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> setVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

  <span class="token comment">// const onVisible = useMemo(() =&gt; {</span>
  <span class="token comment">//   return () =&gt; {</span>
  <span class="token comment">//     setVisible((visible) =&gt; !visible)</span>
  <span class="token comment">//   }</span>
  <span class="token comment">// }, [])</span>
  <span class="token keyword">const</span> onVisible <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token parameter">visible</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>visible<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">changeInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token function">setInfo</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token operator">:</span> <span class="token string">'5px'</span><span class="token punctuation">,</span> marginLeft<span class="token operator">:</span> <span class="token string">'400px'</span><span class="token punctuation">,</span> marginRight<span class="token operator">:</span> <span class="token string">'400px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">changeInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Input</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token attr-name">onVisible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onVisible<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home
</code></pre></div><p>æˆ‘ç›¸ä¿¡ä½ è‚¯å®šå·²ç»çœ‹æ‡‚äº†ï¼Œä»€ä¹ˆï¼Ÿæ²¡çœ‹æ‡‚ï¼Ÿé‚£å†çœ‹ä¸€éï¼</p> <h3 id="è‡ªå®šä¹‰-hook"><a href="#è‡ªå®šä¹‰-hook" class="header-anchor">#</a> è‡ªå®šä¹‰ hook</h3> <p>å€ŸåŠ©äº<code>react</code>æä¾›çš„åŸºç¡€<code>hook</code>,æˆ‘ä»¬é€šå¸¸ä¹Ÿå¯ä»¥è‡ªå®šä¹‰<code>hook</code>ï¼Œ<code>react</code>è§„å®šæˆ‘ä»¬è‡ªå®šä¹‰<code>hook</code>æ—¶ï¼Œå¿…é¡»ä»¥<code>use</code>å¼€å¤´ã€‚æˆ‘ä»¬æ¥å°è¯•è‡ªå®šä¹‰ä¸€ä¸ªæ§åˆ¶å¯¹è¯æ¡†çš„<code>hook</code>:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">type</span> <span class="token class-name">returnd</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">boolean</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>visible<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> useVisible <span class="token operator">=</span> <span class="token punctuation">(</span>initVisible <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token operator">:</span> returnd <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> setVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initVisible<span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">onVisible</span><span class="token punctuation">(</span>value<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newValue <span class="token operator">=</span> value <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token operator">!</span>visible <span class="token operator">:</span> value
    <span class="token function">setVisible</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> onVisible<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useVisible
</code></pre></div><p>é¦–å…ˆæˆ‘ä»¬åˆ©ç”¨<code>useState</code>å£°æ˜äº†<code>visible</code>å’Œ<code>setVisible</code>,ç„¶åæˆ‘ä»¬å®šä¹‰äº†<code>onVisible</code>è¿™ä¸ªå‡½æ•°ç”¨æ¥æ›´æ”¹<code>visible</code>ï¼Œæ¥ç€æˆ‘ä»¬è¿”å›<code>[visible, onVisible]</code>ã€‚ç„¶åæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Modal <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> useVisible <span class="token keyword">from</span> <span class="token string">'../hooks/useVisible'</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> setVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">modalShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setVisible</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token operator">:</span> <span class="token string">'5px'</span><span class="token punctuation">,</span> marginLeft<span class="token operator">:</span> <span class="token string">'400px'</span><span class="token punctuation">,</span> marginRight<span class="token operator">:</span> <span class="token string">'400px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>primary<span class="token punctuation">'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">modalShow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        Open Modal
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Modal</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>Basic Modal<span class="token punctuation">'</span></span> <span class="token attr-name">visible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>visible<span class="token punctuation">}</span></span> <span class="token attr-name">onOk</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">modalShow</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token attr-name">onCancel</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">modalShow</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Some contents...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Some contents...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Some contents...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Modal</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home
</code></pre></div><p>å°±åƒæˆ‘ä»¬ä½¿ç”¨å…¶ä»–<code>hook</code>ä¸€æ ·æ–¹ä¾¿ã€‚æˆ‘ä»¬åœ¨å†™ä¸šåŠ¡(æ¬ç –)çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å»å°†ä¸€äº›å¯å¤ç”¨çš„é€»è¾‘æˆ–è€…æ“ä½œå°è£…ä¸ºæˆ‘ä»¬è‡ªå·±çš„<code>hook</code>ï¼Œè¿™æ‰æ˜¯<code>hooks</code>çš„å¼ºå¤§ä¹‹å¤„ã€‚</p> <h2 id="é¡¹ç›®é…ç½®"><a href="#é¡¹ç›®é…ç½®" class="header-anchor">#</a> é¡¹ç›®é…ç½®</h2> <p>æˆ‘ä»¬åœ¨å¼€å‘<code>react</code>çš„æ—¶å€™ï¼Œä¸å…éœ€è¦ä¸€äº›é…ç½®ï¼Œä¾‹å¦‚åˆ«åã€è·¨åŸŸç­‰ç­‰ã€‚<code>vue</code>ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª<code>vue.config.js</code>ç”¨äºé…ç½®ï¼Œé‚£ä¹ˆ<code>react</code>é¡¹ç›®å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦ç”¨åˆ°<code>react-app-rewired</code>å’Œ<code>customize-cra</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code>yarn add react<span class="token operator">-</span>app<span class="token operator">-</span>rewired <span class="token operator">-</span><span class="token constant">D</span>
yarn add customize<span class="token operator">-</span>cra <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>å®‰è£…å®Œä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ›´æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„<code>package.json</code>æ–‡ä»¶ï¼š</p> <div class="language-json extra-class"><pre class="language-json"><code>....
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired start&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired test --env=jsdom&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eject&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts eject&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
....
</code></pre></div><p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•æ–°å»ºä¸€ä¸ª<code>config-overrides.js</code>æ–‡ä»¶ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹é¡¹ç›®è¿›è¡Œä¸€äº›é…ç½®ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* config-overrides.js */</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> override<span class="token punctuation">,</span> addWebpackResolve<span class="token punctuation">,</span> fixBabelImports<span class="token punctuation">,</span> overrideDevServer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'customize-cra'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> addReactRefresh <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'customize-cra-react-refresh'</span><span class="token punctuation">)</span>
<span class="token comment">// é…ç½®å¼€å‘ç¯å¢ƒè·¨åŸŸ</span>
<span class="token keyword">const</span> <span class="token function-variable function">devServerConfig</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>config<span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'/mock/158/airi'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        target<span class="token operator">:</span> <span class="token string">'https://api.guaik.org'</span><span class="token punctuation">,</span>
        changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        secure<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  webpack<span class="token operator">:</span> <span class="token function">override</span><span class="token punctuation">(</span>
    <span class="token comment">// çƒ­åŠ è½½</span>
    <span class="token function">addReactRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// é…ç½®è·¯å¾„åˆ«å</span>
    <span class="token function">addWebpackResolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      alias<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// antd æŒ‰éœ€åŠ è½½</span>
    <span class="token function">fixBabelImports</span><span class="token punctuation">(</span><span class="token string">'import'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      libraryName<span class="token operator">:</span> <span class="token string">'antd'</span><span class="token punctuation">,</span>
      libraryDirectory<span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>
      style<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  devServer<span class="token operator">:</span> <span class="token function">overrideDevServer</span><span class="token punctuation">(</span><span class="token function">devServerConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ›´å¤šçš„é…ç½®è¯·æŸ¥çœ‹è¿™é‡Œ:<a href="https://github.com/arackaf/customize-cra/blob/master/api.md" target="_blank" rel="noopener noreferrer">customize-cra<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <p><code>react</code> çš„çŸ¥è¯†ç‚¹çœŸçš„å¾ˆå¤šï¼Œå¯¹ä¸ï¼Ÿæœ¬æ–‡åªæ˜¯ä¸€ä¸ªå…¥é—¨æ¦‚è§ˆï¼Œè¿˜æœ‰å¾ˆå¤šå¾ˆå¤šçš„çŸ¥è¯†ç‚¹ï¼Œå¸Œæœ›å°ä¼™ä¼´ä»¬é€šè¿‡è¿™ç¯‡æ–‡ç« å¯¹ <code>react</code> æœ‰ä¸ªå¤§è‡´äº†è§£ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿå¯ä»¥ä½œä¸ºé¢è¯•å¤ä¹ åŸºç¡€çŸ¥è¯†çš„ç¬”è®°ï¼Œç¬”è€…èŠ±äº†ä¸¤å‘¨æ—¶é—´ï¼Œæ•´ç†äº†è¿™æ ·ä¸€ç¯‡<code>react</code>å…¥é—¨çš„æ–‡ç« ,å†™åˆ°è¿™é‡Œå·²ç»å‡Œæ™¨ 1 ç‚¹ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œé‚£å°±ç‚¹ä¸ªèµå§ â¤ï¸</p> <h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="header-anchor">#</a> å‚è€ƒ</h2> <p>1ã€https://medium.com/dailyjs/when-do-i-know-im-ready-for-redux-f34da253c85f</p> <p>2ã€https://juejin.im/post/5c18de8ef265da616413f332</p> <p>3ã€https://juejin.im/post/5dcaaa276fb9a04a965e2c9b</p> <p>4ã€https://juejin.im/post/5dbbdbd5f265da4d4b5fe57d</p> <p>5ã€https://github.com/monsterooo/blog/issues/37</p> <p>6ã€https://github.com/monsterooo/blog/issues/28</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/well-he/vblog/edit/master/front-end/react/reactå…¥é—¨å¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹.md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘æ”¹å–„è¿™ä¸ªé¡µé¢</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">æœ€åæ›´æ–°æ—¶é—´:</span> <span class="time">3/4/2022, 9:42:37 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/vblog/front-end/react/ReactåŸºç¡€çŸ¥è¯†.html">
        ReactåŸºç¡€çŸ¥è¯†
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"><!----><div id="goTop" class="hide-cat" data-v-bf92849a></div></div></div>
    <script src="/vblog/assets/js/app.f9cc2ca1.js" defer></script><script src="/vblog/assets/js/2.8e16adc6.js" defer></script><script src="/vblog/assets/js/72.e1d9d0ff.js" defer></script>
  </body>
</html>